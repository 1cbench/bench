task,description,context,validation,gt_solution,run_context
"Создай функцию ЗаполнитьТабличнуюЧастьОстатками(ДокументОбъект), которая заполняет табличную часть документа «Заказ» «Товары» остатками из регистра «ТоварныеЗапасы» для склада и даты, заданных в документе. Отбирать только товары видом товара = Товар. Для каждой позиции остатка нужно добавить строку в табличную часть и перенести туда товар и количество.","Для каждой строки табличной части «Товары» вычисли Сумма = Окр(Количество * Цена, 2). После прохода по всем строкам установи ДокументОбъект.Итого как сумму всех Сумма.","{
  ""Documents"": [
    {
      ""id"": ""Заказ"",
      ""properties"": [
        ""Номер"": ""string"",
        ""Дата"": ""date"",
        ""Клиент"": ""Ref.Контрагенты"",
        ""Склад"": ""Ref.Склады"",
        ""Комментарий"": ""string""
      ],
      ""tabularSections"": [
        {
          ""Товары"": [
            ""Номенклатура"": ""Ref.Номенклатура"",
            ""Количество"": ""number"",
            ""Цена"": ""number"",
            ""Сумма"": ""calculated as Количество * Цена""
          ]
        }
      ]
    }
  ]
}","Функция ЗадачаРешена(ДокументОбъект) Экспорт
    // Проверяем ровно две строки и точные количества
    Если ДокументОбъект.Товары.Количество() <> 19 Тогда
        Возврат Ложь;
    КонецЕсли;

   	СуммаКоличеств = 0;
	Для каждого СтрТовар Из ДокументОбъект.Товары Цикл
	    СуммаКоличеств = СуммаКоличеств + СтрТовар.Количество;
	КонецЦикла;

	Возврат СуммаКоличеств = 299;    
	
КонецФункции
","Функция ЗаполнитьТабличнуюЧастьОстатками(ДокументОбъект)
	Запрос = Новый Запрос();
	Запрос.Текст = 
	""ВЫБРАТЬ
	|	Т.Товар КАК Товар,
	|	Т.КоличествоОстаток КАК Количество
	|ИЗ
	|	РегистрНакопления.ТоварныеЗапасы.Остатки(&Дата, Склад = &Склад) КАК Т
	|ГДЕ
	|	Т.Товар.Вид = ЗНАЧЕНИЕ(Перечисление.ВидыТоваров.Товар)"";    
	
	Запрос.УстановитьПараметр(""Дата"",  ДокументОбъект.Дата);   
	Запрос.УстановитьПараметр(""Склад"", ДокументОбъект.Склад);

	Выборка = Запрос.Выполнить().Выбрать();
	Пока Выборка.Следующий() Цикл
		СтрокаТЧ = ДокументОбъект.Товары.Добавить();
		ЗаполнитьЗначенияСвойств(СтрокаТЧ, Выборка);
	КонецЦикла;  
	
КонецФункции
","Функция ЗапуститьРешение() Экспорт
	ДокументОбъект = Документы.Заказ.СоздатьДокумент();	                   
	ДокументОбъект.Дата = '20250920';
	ДокументОбъект.Склад = Справочники.Склады.НайтиПоНаименованию(""Большой"");    
	ЗаполнитьТабличнуюЧастьОстатками(ДокументОбъект);
	
	Возврат ЗадачаРешена(ДокументОбъект);
КонецФункции

"
"Создай функцию ЗаполнитьТабличныйДокумент(ТабДокумент, Макет, Дата) которая выводит в табличный документ задолженность по контрагентам из регистра Взаиморасчеты на дату. В макете есть секции Шапка и Строка, в секции строка есть параметры “Контрагент” и “Задолженность”","Пройдись по ТЧ «Товары» в обратном порядке и удали строки, где Количество <= 0. Остальные строки не изменяй.","{
  ""AccumulationRegisters"": [
    {
      ""id"": ""Взаиморасчеты"",
      ""name"": ""Взаиморасчеты"",
      ""RegisterType"": ""Balance"",
      ""Dimensions"": [
        {
          ""id"": ""Контрагент"",
          ""name"": ""Контрагент"",
          ""types"": [
            {
              ""type"": ""Ref"",
              ""id"": ""Справочник.Контрагенты""
            }
          ]
        },
        {
          ""id"": ""Валюта"",
          ""name"": ""Валюта"",
          ""types"": [
            {
              ""type"": ""Ref"",
              ""id"": ""Справочник.Валюты""
            }
          ]
        }
      ],
      ""Resources"": [
        {
          ""id"": ""Сумма"",
          ""name"": ""Сумма"",
          ""types"": [
            {
              ""type"": ""Number"",
              ""NumberQualifiers"": ""10.2""
            }
          ]
        }
      ]
    }
  ]
}","Функция ЗадачаРешена(ТабДокумент) Экспорт

	Если ТабДокумент.ВысотаТаблицы < 13 Тогда 
		Возврат Ложь;
	КонецЕсли;

	// Получаем значения из первых двух строк данных (индексация с 1)
	Значение1 = ТабДокумент.Область(""R1C1"").Текст;  
	Значение2 = ТабДокумент.Область(""R3C1"").Текст;  
	Значение3 = ТабДокумент.Область(""R3C2"").Текст;

	Если Значение1 <> ""Контрагент"" Или Значение2 <> ""Магазин """"Продукты"""""" ИЛИ Значение3 <> ""323390"" Тогда
		Возврат Ложь;
	КонецЕсли;

	Возврат Истина;

КонецФункции


","
Функция ЗаполнитьТабличныйДокумент(ТабДокумент, Макет, Дата) Экспорт

	// Граница периода: берём остатки на конец дня указанной даты
	ДатаКон = КонецДня(Дата);

	// Запрос по виртуальной таблице Остатки регистра ""Взаиморасчеты"".
	// Суммируем по контрагенту (валюту игнорируем — если нужно раздельно по валютам,
	// добавьте поле Валюта в выборку/группировку и параметр в макет).
	Запрос = Новый Запрос;
	Запрос.Текст =
	""ВЫБРАТЬ
	|	Остатки.Контрагент КАК Контрагент,
	|	СУММА(Остатки.СуммаОстаток) КАК Задолженность
	|ИЗ
	|	РегистрНакопления.Взаиморасчеты.Остатки(&ДатаКон, ) КАК Остатки
	|СГРУППИРОВАТЬ ПО
	|	Остатки.Контрагент
	|ИМЕЮЩИЕ
	|	СУММА(Остатки.СуммаОстаток) <> 0
	|УПОРЯДОЧИТЬ ПО
	|	Контрагент"";

	Запрос.УстановитьПараметр(""ДатаКон"", ДатаКон);

	Результат = Запрос.Выполнить();
	Выборка = Результат.Выбрать();

	// Подготовка табличного документа
	ТабДокумент.Очистить();

	Если Макет <> Неопределено Тогда
		ОбластьШапка = Макет.ПолучитьОбласть(""Шапка"");
		Если ОбластьШапка <> Неопределено Тогда
			ТабДокумент.Вывести(ОбластьШапка);
		КонецЕсли;
	КонецЕсли;

	ЕстьДанные = Ложь;

	Пока Выборка.Следующий() Цикл
		ЕстьДанные = Истина;

		ОбластьСтрока = Макет.ПолучитьОбласть(""Строка"");
		Если ОбластьСтрока = Неопределено Тогда
			ВызватьИсключение ""В макете отсутствует секция 'Строка'."";
		КонецЕсли;

		ОбластьСтрока.Параметры.Контрагент    = Выборка.Контрагент;
		ОбластьСтрока.Параметры.Задолженность = Выборка.Задолженность;

		ТабДокумент.Вывести(ОбластьСтрока);
	КонецЦикла;

	Возврат ТабДокумент;

КонецФункции
","Функция ЗапуститьРешение() Экспорт
	Макет = ЭтотОбъект.ПолучитьМакет(""Задача3"");	                   
    ТабДокумент = Новый ТабличныйДокумент();   
	Дата = '20250920';
	ЗаполнитьТабличныйДокумент(ТабДокумент, Макет, Дата);
	
	Возврат ЗадачаРешена(ТабДокумент);
КонецФункции

"
"Создай функцию, которая устанавливает во всех строках ТЧ «Товары» значение поля «СкладСтроки» равным реквизиту документа «Склад».","Если в строке склад не заполнен или отличается от ДокументОбъект.Склад, замени его на значение реквизита документа. Другие поля не изменяй.","{
  ""Documents"": [
    {
      ""id"": ""Заказ"",
      ""properties"": [
        ""Номер"": ""string"",
        ""Дата"": ""date"",
        ""Клиент"": ""Ref.Контрагенты"",
        ""Склад"": ""Ref.Склады"",
        ""Комментарий"": ""string""
      ],
      ""tabularSections"": [
        {
          ""Товары"": [
            ""Номенклатура"": ""Ref.Номенклатура"",
            ""Количество"": ""number"",
            ""Цена"": ""number"",
            ""Сумма"": ""calculated as Количество * Цена""
          ]
        }
      ]
    }
  ]
}","Функция ЗадачаРешена(ТабДокумент) Экспорт

	Если ТабДокумент.ВысотаТаблицы < 13 Тогда 
		Возврат Ложь;
	КонецЕсли;

	// Получаем значения из первых двух строк данных (индексация с 1)
	Значение1 = ТабДокумент.Область(""R1C1"").Текст;  
	Значение2 = ТабДокумент.Область(""R3C1"").Текст;  
	Значение3 = ТабДокумент.Область(""R3C2"").Текст;

	Если Значение1 <> ""Контрагент"" Или Значение2 <> ""Магазин """"Продукты"""""" ИЛИ Значение3 <> ""323391"" Тогда
		Возврат Ложь;
	КонецЕсли;

	Возврат Истина;

КонецФункции


","
Функция ЗаполнитьТабличныйДокумент(ТабДокумент, Макет, Дата) Экспорт

	// Граница периода: берём остатки на конец дня указанной даты
	ДатаКон = КонецДня(Дата);

	// Запрос по виртуальной таблице Остатки регистра ""Взаиморасчеты"".
	// Суммируем по контрагенту (валюту игнорируем — если нужно раздельно по валютам,
	// добавьте поле Валюта в выборку/группировку и параметр в макет).
	Запрос = Новый Запрос;
	Запрос.Текст =
	""ВЫБРАТЬ
	|	Остатки.Контрагент КАК Контрагент,
	|	СУММА(Остатки.СуммаОстаток) КАК Задолженность
	|ИЗ
	|	РегистрНакопления.Взаиморасчеты.Остатки(&ДатаКон, ) КАК Остатки
	|СГРУППИРОВАТЬ ПО
	|	Остатки.Контрагент
	|ИМЕЮЩИЕ
	|	СУММА(Остатки.СуммаОстаток) <> 0
	|УПОРЯДОЧИТЬ ПО
	|	Контрагент"";

	Запрос.УстановитьПараметр(""ДатаКон"", ДатаКон);

	Результат = Запрос.Выполнить();
	Выборка = Результат.Выбрать();

	// Подготовка табличного документа
	ТабДокумент.Очистить();

	Если Макет <> Неопределено Тогда
		ОбластьШапка = Макет.ПолучитьОбласть(""Шапка"");
		Если ОбластьШапка <> Неопределено Тогда
			ТабДокумент.Вывести(ОбластьШапка);
		КонецЕсли;
	КонецЕсли;

	ЕстьДанные = Ложь;

	Пока Выборка.Следующий() Цикл
		ЕстьДанные = Истина;

		ОбластьСтрока = Макет.ПолучитьОбласть(""Строка"");
		Если ОбластьСтрока = Неопределено Тогда
			ВызватьИсключение ""В макете отсутствует секция 'Строка'."";
		КонецЕсли;

		ОбластьСтрока.Параметры.Контрагент    = Выборка.Контрагент;
		ОбластьСтрока.Параметры.Задолженность = Выборка.Задолженность;

		ТабДокумент.Вывести(ОбластьСтрока);
	КонецЦикла;

	Возврат ТабДокумент;

КонецФункции
","Функция ЗапуститьРешение() Экспорт
	Макет = ЭтотОбъект.ПолучитьМакет(""Задача3"");	                   
    ТабДокумент = Новый ТабличныйДокумент();   
	Дата = '20250920';
	ЗаполнитьТабличныйДокумент(ТабДокумент, Макет, Дата);
	
	Возврат ЗадачаРешена(ТабДокумент);
КонецФункции

"
Создай функцию УдалитьПоследнююЗапись(Валюта) которая удалять последнюю по времени запись регистра сведений КурсыВалют с измерением Валюта = Валюта,,,"Функция ЗадачаРешена(Валюта)      
	
	Запрос = Новый Запрос;   
	Запрос.УстановитьПараметр(""Валюта"", Валюта);
	Запрос.Текст =
	""ВЫБРАТЬ
	|	КурсыВалют.Период КАК Период
	|ИЗ
	|	РегистрСведений.КурсыВалют КАК КурсыВалют
	|ГДЕ
	|	КурсыВалют.Валюта = &Валюта
	|
	|УПОРЯДОЧИТЬ ПО
	|	Период УБЫВ"";  
	
	Выборка = Запрос.Выполнить().Выбрать();
	Если НЕ Выборка.Следующий() Тогда
	
		Возврат Ложь;
	
	КонецЕсли;     
	
	Возврат Выборка.Период = Дата('20221225');

КонецФункции



","Функция УдалитьПоследнююЗапись(Валюта) Экспорт
    
    // 1) Находим самый поздний Период для заданной валюты
    Запрос = Новый Запрос(
    ""ВЫБРАТЬ ПЕРВЫЕ 1
     |    Курсы.Период КАК Период
     |ИЗ
     |    РегистрСведений.КурсыВалют КАК Курсы
     |ГДЕ
     |    Курсы.Валюта = &Валюта
     |УПОРЯДОЧИТЬ ПО
     |    Курсы.Период УБЫВ"");
    Запрос.УстановитьПараметр(""Валюта"", Валюта);

    Рез = Запрос.Выполнить();
    Выборка = Рез.Выбрать();

    Если Не Выборка.Следующий() Тогда
        Возврат Ложь; // записей по валюте нет
    КонецЕсли;

    // 2) Удаляем именно эту запись по ключам (Валюта + Период)
    Менеджер = РегистрыСведений.КурсыВалют.СоздатьМенеджерЗаписи();
    Менеджер.Валюта = Валюта;
    Менеджер.Период = Выборка.Период;
    Менеджер.Прочитать();

    Если Менеджер.Выбран() Тогда
        Менеджер.Удалить();
    КонецЕсли;

КонецФункции

","Функция ЗапуститьРешение() Экспорт
	
	// Снимок всех записей регистра -> ТаблицаЗначений
	НаборВсе = РегистрыСведений.КурсыВалют.СоздатьНаборЗаписей();
	НаборВсе.Прочитать();
	Снимок = НаборВсе.Выгрузить(); // ТаблицаЗначений «как есть»
	ВалютаЮСД = Справочники.Валюты.НайтиПоНаименованию(""USD"");
	УдалитьПоследнююЗапись(ВалютаЮСД);
	
	Решена =  ЗадачаРешена(ВалютаЮСД);

	// Восстановим регистр в исходное состояние
	НаборВосстановление = РегистрыСведений.КурсыВалют.СоздатьНаборЗаписей();
	НаборВосстановление.Записать(); 
	НаборВосстановление.Загрузить(Снимок);
	НаборВосстановление.Записать();  
	
	Возврат Решена;
	
КонецФункции


"
Создай функцию НеУстановленыЦены(Поставщик) которая возвращает СписокЗначений с элементами справочника Товары у которых Поставщик = Поставщик и нет записи в регистре сведений ЦеныТоваров,,"{
  ""InformationRegisters"": [
    {
      ""id"": ""ЦеныТоваров"",
      ""name"": ""Цены товаров"",
      ""InformationRegisterPeriodicity"": ""Day"",
      ""WriteMode"": ""Independent"",
      ""Dimensions"": [
        {
          ""id"": ""Товар"",
          ""name"": ""Товар"",
          ""types"": [
            {
              ""type"": ""Ref"",
              ""id"": ""Справочник.Товары""
            }
          ]
        },
        {
          ""id"": ""ВидЦен"",
          ""name"": ""Вид цен"",
          ""types"": [
            {
              ""type"": ""Ref"",
              ""id"": ""Справочник.ВидыЦен""
            }
          ]
        }
      ],
      ""Resources"": [
        {
          ""id"": ""Цена"",
          ""name"": ""Цена"",
          ""types"": [
            {
              ""type"": ""Number"",
              ""NumberQualifiers"": ""10.2""
            }
          ]
        }
      ]
    }
  ]
}","Функция ЗадачаРешена(СписокТоваров, ОжидаемыеТовары) Экспорт

	// Проверяем тип результата
	Если ТипЗнч(СписокТоваров) <> Тип(""СписокЗначений"") Тогда
		Возврат Ложь;
	КонецЕсли;

	// Проверяем количество элементов
	Если СписокТоваров.Количество() <> ОжидаемыеТовары.Количество() Тогда
		Возврат Ложь;
	КонецЕсли;

	// Проверяем, что все ожидаемые товары присутствуют в списке
	Для Каждого ОжидаемыйТовар Из ОжидаемыеТовары Цикл
		ЭлементСписка = СписокТоваров.НайтиПоЗначению(ОжидаемыйТовар.Значение);
		Если ЭлементСписка = Неопределено Тогда
			Возврат Ложь;
		КонецЕсли;
	КонецЦикла;

	// Проверяем, что в списке нет лишних товаров
	Для Каждого ЭлементСписка Из СписокТоваров Цикл
		Найден = Ложь;
		Для Каждого ОжидаемыйТовар Из ОжидаемыеТовары Цикл
			Если ЭлементСписка.Значение = ОжидаемыйТовар.Значение Тогда
				Найден = Истина;
				Прервать;
			КонецЕсли;
		КонецЦикла;

		Если НЕ Найден Тогда
			Возврат Ложь;
		КонецЕсли;
	КонецЦикла;

	Возврат Истина;

КонецФункции
","Функция НеУстановленыЦены(Поставщик) Экспорт

 // Запрос для получения товаров поставщика, у которых нет записей в регистре ЦеныТоваров
 Запрос = Новый Запрос;
 Запрос.Текст =
 ""ВЫБРАТЬ
 | Товары.Ссылка КАК Товар
 |ИЗ
 | Справочник.Товары КАК Товары
 |  ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ЦеныТоваров КАК ЦеныТоваров
 |  ПО Товары.Ссылка = ЦеныТоваров.Товар
 |ГДЕ
 | Товары.Поставщик = &Поставщик
 | И Товары.ЭтоГруппа = ЛОЖЬ
 | И НЕ Товары.ПометкаУдаления
 | И ЦеныТоваров.Товар ЕСТЬ NULL
 |УПОРЯДОЧИТЬ ПО
 | Товар"";

 Запрос.УстановитьПараметр(""Поставщик"", Поставщик);

 Результат = Запрос.Выполнить();
 Выборка = Результат.Выбрать();

 // Создаём список значений для возврата
 СписокТоваров = Новый СписокЗначений;

 Пока Выборка.Следующий() Цикл
  СписокТоваров.Добавить(Выборка.Товар);
 КонецЦикла;

 Возврат СписокТоваров;

КонецФункции
","Функция ЗапуститьРешение() Экспорт

 	// Подготовка тестовых данных: создаём поставщика
 	Поставщик = Справочники.Контрагенты.НайтиПоНаименованию(""Тестовый поставщик"");

	Если Поставщик.Пустая() Тогда
		Поставщик = Справочники.Контрагенты.СоздатьЭлемент();
		Поставщик.Наименование = ""Тестовый поставщик"";
		Поставщик.Записать();
		Поставщик = Поставщик.Ссылка; 
	КонецЕсли;    
	
	ДругойПоставщик = Справочники.Контрагенты.НайтиПоНаименованию(""Другой поставщик"");

	Если ДругойПоставщик.Пустая() Тогда
		ДругойПоставщик = Справочники.Контрагенты.СоздатьЭлемент();
		ДругойПоставщик.Наименование = ""Другой поставщик"";
		ДругойПоставщик.Записать();
		ДругойПоставщик = Поставщик.Ссылка; 
	КонецЕсли;


 // Создаём вид цен для теста (если нужен)
 ВидЦен = Справочники.ВидыЦен.НайтиПоНаименованию(""Базовая"");

 Если ВидЦен.Пустая() Тогда
  ВидЦен = Справочники.ВидыЦен.СоздатьЭлемент();
  ВидЦен.Наименование = ""Базовая"";
  ВидЦен.Записать(); 
  ВидЦен = ВидЦен.Ссылка; 
 КонецЕсли;

 // Создаём товары для теста
 // Товар 1 - с ценой (не должен попасть в список)
 Товар1 = Справочники.Товары.СоздатьЭлемент();
 Товар1.Наименование = ""Товар с ценой"";
 Товар1.Поставщик = Поставщик;
 Товар1.Записать();

 МенеджерЦены1 = РегистрыСведений.ЦеныТоваров.СоздатьМенеджерЗаписи();
 МенеджерЦены1.Период = ТекущаяДатаСеанса();
 МенеджерЦены1.Товар = Товар1.Ссылка;
 МенеджерЦены1.ВидЦен = ВидЦен;
 МенеджерЦены1.Цена = 100;
 МенеджерЦены1.Записать();

 // Товар 2 - без цены (должен попасть в список)
 Товар2 = Справочники.Товары.СоздатьЭлемент();
 Товар2.Наименование = ""Товар без цены 1"";
 Товар2.Поставщик = Поставщик;
 Товар2.Записать();

 // Товар 3 - без цены (должен попасть в список)
 Товар3 = Справочники.Товары.СоздатьЭлемент();
 Товар3.Наименование = ""Товар без цены 2"";
 Товар3.Поставщик = Поставщик;
 Товар3.Записать();

 Товар4 = Справочники.Товары.СоздатьЭлемент();
 Товар4.Наименование = ""Товар другого поставщика"";
 Товар4.Поставщик = ДругойПоставщик;
 Товар4.Записать();

 // Формируем ожидаемый список товаров без цен
 ОжидаемыеТовары = Новый СписокЗначений;
 ОжидаемыеТовары.Добавить(Товар2.Ссылка);
 ОжидаемыеТовары.Добавить(Товар3.Ссылка);

 // Вызов функции задачи
 СписокТоваров = НеУстановленыЦены(Поставщик);

 // Вызов функции валидатора для проверки решения задачи
 РезультатПроверки = ЗадачаРешена(СписокТоваров, ОжидаемыеТовары);

 // Удаление тестовых данных
 // Удаляем запись регистра цен
 МенеджерУдаления = РегистрыСведений.ЦеныТоваров.СоздатьМенеджерЗаписи();
 МенеджерУдаления.Период = МенеджерЦены1.Период;
 МенеджерУдаления.Товар = Товар1.Ссылка;
 МенеджерУдаления.ВидЦен = ВидЦен;
 МенеджерУдаления.Удалить();

 // Удаляем товары
 Товар1.Удалить();
 Товар2.Удалить();
 Товар3.Удалить();
 Товар4.Удалить();

 // Удаляем контрагентов
 Поставщик.ПолучитьОбъект().Удалить();
 ДругойПоставщик.ПолучитьОбъект().Удалить();

 // Удаляем вид цен
 ВидЦен.ПолучитьОбъект().Удалить();

 Возврат РезультатПроверки;

КонецФункции
"
"Создай функцию ВыгрузитьОстаткиСклада(Склад, МинимальныйОстаток, ФайлJson), которая получает остаки товаров склада на текущую дату из регистра ТоварныеЗапасы у которых остаток больше или равен значению МинимальныйОстаток. Записать файл в json формате как список с полями ""Товар_Код"", ""Товар_Наименование"", ""Остаток"" (число, округленное до целого).",,"{
  ""AccumulationRegisters"": [
    {
      ""id"": ""ТоварныеЗапасы"",
      ""name"": ""Товарные запасы"",
      ""RegisterType"": ""Balance"",
      ""Dimensions"": [
        {
          ""id"": ""Товар"",
          ""name"": ""Товар"",
          ""types"": [
            {
              ""type"": ""Ref"",
              ""id"": ""Справочник.Товары""
            }
          ]
        },
        {
          ""id"": ""Склад"",
          ""name"": ""Склад"",
          ""types"": [
            {
              ""type"": ""Ref"",
              ""id"": ""Справочник.Склады""
            }
          ]
        }
      ],
      ""Resources"": [
        {
          ""id"": ""Количество"",
          ""name"": ""Количество"",
          ""types"": [
            {
              ""type"": ""Number"",
              ""NumberQualifiers"": ""10.2""
            }
          ]
        }
      ]
    }
  ]
}","Функция ЗадачаРешена(ФайлJson, ОжидаемыеДанные) Экспорт

	// Проверяем существование файла
	ФайлОбъект = Новый Файл(ФайлJson);
	Если НЕ ФайлОбъект.Существует() Тогда
		Возврат Ложь;
	КонецЕсли;

	// Читаем JSON из файла
	ЧтениеJSON = Новый ЧтениеJSON;
	ЧтениеJSON.ОткрытьФайл(ФайлJson);
	МассивДанных = ПрочитатьJSON(ЧтениеJSON);
	ЧтениеJSON.Закрыть();

	// Проверяем тип результата
	Если ТипЗнч(МассивДанных) <> Тип(""Массив"") Тогда
		Возврат Ложь;
	КонецЕсли;

	// Проверяем количество элементов
	Если МассивДанных.Количество() <> ОжидаемыеДанные.Количество() Тогда
		Возврат Ложь;
	КонецЕсли;

	// Проверяем каждый элемент
	Для Индекс = 0 По МассивДанных.ВГраница() Цикл
		ФактическаяСтрока = МассивДанных[Индекс];
		ОжидаемаяСтрока = ОжидаемыеДанные[Индекс];

		// Проверяем наличие обязательных полей
		Если НЕ ФактическаяСтрока.Свойство(""Товар_Код"")
			ИЛИ НЕ ФактическаяСтрока.Свойство(""Товар_Наименование"")
			ИЛИ НЕ ФактическаяСтрока.Свойство(""Остаток"") Тогда
			Возврат Ложь;
		КонецЕсли;

		// Проверяем значения полей
		Если ФактическаяСтрока.Товар_Код <> ОжидаемаяСтрока.Товар_Код
			ИЛИ ФактическаяСтрока.Товар_Наименование <> ОжидаемаяСтрока.Товар_Наименование
			ИЛИ ФактическаяСтрока.Остаток <> ОжидаемаяСтрока.Остаток Тогда
			Возврат Ложь;
		КонецЕсли;

		// Проверяем, что остаток - целое число
		Если ФактическаяСтрока.Остаток <> Окр(ФактическаяСтрока.Остаток, 0) Тогда
			Возврат Ложь;
		КонецЕсли;
	КонецЦикла;

	Возврат Истина;

КонецФункции
","Функция ВыгрузитьОстаткиСклада(Склад, МинимальныйОстаток, ФайлJson) Экспорт

	// Запрос для получения остатков товаров на складе
	Запрос = Новый Запрос;
	Запрос.Текст =
	""ВЫБРАТЬ
	|	Остатки.Товар.Код КАК Товар_Код,
	|	Остатки.Товар.Наименование КАК Товар_Наименование,
	|	Остатки.КоличествоОстаток КАК Остаток
	|ИЗ
	|	РегистрНакопления.ТоварныеЗапасы.Остатки(&ТекущаяДата, Склад = &Склад) КАК Остатки
	|ГДЕ
	|	Остатки.КоличествоОстаток >= &МинимальныйОстаток
	|УПОРЯДОЧИТЬ ПО
	|	Товар_Код"";

	Запрос.УстановитьПараметр(""ТекущаяДата"", ТекущаяДатаСеанса());
	Запрос.УстановитьПараметр(""Склад"", Склад);
	Запрос.УстановитьПараметр(""МинимальныйОстаток"", МинимальныйОстаток);

	Результат = Запрос.Выполнить();
	Выборка = Результат.Выбрать();

	// Формируем массив для JSON
	МассивДанных = Новый Массив;

	Пока Выборка.Следующий() Цикл
		СтрокаДанных = Новый Структура;
		СтрокаДанных.Вставить(""Товар_Код"", Выборка.Товар_Код);
		СтрокаДанных.Вставить(""Товар_Наименование"", Выборка.Товар_Наименование);
		СтрокаДанных.Вставить(""Остаток"", Окр(Выборка.Остаток, 0, РежимОкругления.Окр15как20));

		МассивДанных.Добавить(СтрокаДанных);
	КонецЦикла;

	// Записываем JSON в файл
	ЗаписьJSON = Новый ЗаписьJSON;
	ЗаписьJSON.ОткрытьФайл(ФайлJson);
	ЗаписатьJSON(ЗаписьJSON, МассивДанных);
	ЗаписьJSON.Закрыть();

	Возврат Истина;

КонецФункции
","Функция ЗапуститьРешение() Экспорт

	// Подготовка тестовых данных: создаём склад
	Склад = Справочники.Склады.НайтиПоНаименованию(""Тестовый склад"");

	Если Склад.Пустая() Тогда
		Склад = Справочники.Склады.СоздатьЭлемент();
		Склад.Наименование = ""Тестовый склад"";
		Склад.Записать();
	КонецЕсли;

	// Создаём товары для теста
	Товар1 = Справочники.Товары.СоздатьЭлемент();
	Товар1.Код = ""001"";
	Товар1.Наименование = ""Товар с большим остатком"";
	Товар1.Записать();

	Товар2 = Справочники.Товары.СоздатьЭлемент();
	Товар2.Код = ""002"";
	Товар2.Наименование = ""Товар со средним остатком"";
	Товар2.Записать();

	Товар3 = Справочники.Товары.СоздатьЭлемент();
	Товар3.Код = ""003"";
	Товар3.Наименование = ""Товар с малым остатком"";
	Товар3.Записать();

	// Создаём движения в регистре ТоварныеЗапасы
	// Товар 1: остаток 150.7 (округлится до 151)
	НаборЗаписей1 = РегистрыНакопления.ТоварныеЗапасы.СоздатьНаборЗаписей();
	НаборЗаписей1.Отбор.Товар.Установить(Товар1.Ссылка);
	НаборЗаписей1.Отбор.Склад.Установить(Склад);

	Движение1 = НаборЗаписей1.Добавить();
	Движение1.Период = ТекущаяДатаСеанса();
	Движение1.ВидДвижения = ВидДвиженияНакопления.Приход;
	Движение1.Товар = Товар1.Ссылка;
	Движение1.Склад = Склад;
	Движение1.Количество = 150.7;

	НаборЗаписей1.Записать();

	// Товар 2: остаток 50.3 (округлится до 50)
	НаборЗаписей2 = РегистрыНакопления.ТоварныеЗапасы.СоздатьНаборЗаписей();
	НаборЗаписей2.Отбор.Товар.Установить(Товар2.Ссылка);
	НаборЗаписей2.Отбор.Склад.Установить(Склад);

	Движение2 = НаборЗаписей2.Добавить();
	Движение2.Период = ТекущаяДатаСеанса();
	Движение2.ВидДвижения = ВидДвиженияНакопления.Приход;
	Движение2.Товар = Товар2.Ссылка;
	Движение2.Склад = Склад;
	Движение2.Количество = 50.3;

	НаборЗаписей2.Записать();

	// Товар 3: остаток 5.5 (округлится до 6, но меньше минимального)
	НаборЗаписей3 = РегистрыНакопления.ТоварныеЗапасы.СоздатьНаборЗаписей();
	НаборЗаписей3.Отбор.Товар.Установить(Товар3.Ссылка);
	НаборЗаписей3.Отбор.Склад.Установить(Склад);

	Движение3 = НаборЗаписей3.Добавить();
	Движение3.Период = ТекущаяДатаСеанса();
	Движение3.ВидДвижения = ВидДвиженияНакопления.Приход;
	Движение3.Товар = Товар3.Ссылка;
	Движение3.Склад = Склад;
	Движение3.Количество = 5.5;

	НаборЗаписей3.Записать();

	// Формируем ожидаемые данные (минимальный остаток = 10)
	МинимальныйОстаток = 10;
	ОжидаемыеДанные = Новый Массив;

	// Только товары с остатком >= 10
	СтрокаТовар1 = Новый Структура;
	СтрокаТовар1.Вставить(""Товар_Код"", ""001"");
	СтрокаТовар1.Вставить(""Товар_Наименование"", ""Товар с большим остатком"");
	СтрокаТовар1.Вставить(""Остаток"", 151);
	ОжидаемыеДанные.Добавить(СтрокаТовар1);

	СтрокаТовар2 = Новый Структура;
	СтрокаТовар2.Вставить(""Товар_Код"", ""002"");
	СтрокаТовар2.Вставить(""Товар_Наименование"", ""Товар со средним остатком"");
	СтрокаТовар2.Вставить(""Остаток"", 50);
	ОжидаемыеДанные.Добавить(СтрокаТовар2);

	// Путь к файлу JSON
	ФайлJson = ПолучитьИмяВременногоФайла(""json"");

	// Вызов функции задачи
	ВыгрузитьОстаткиСклада(Склад, МинимальныйОстаток, ФайлJson);

	// Вызов функции валидатора для проверки решения задачи
	РезультатПроверки = ЗадачаРешена(ФайлJson, ОжидаемыеДанные);

	// Удаление тестовых данных
	// Удаляем записи регистра
	НаборЗаписей1.Очистить();
	НаборЗаписей1.Записать();

	НаборЗаписей2.Очистить();
	НаборЗаписей2.Записать();

	НаборЗаписей3.Очистить();
	НаборЗаписей3.Записать();

	// Удаляем товары
	Товар1.ПолучитьОбъект().Удалить();
	Товар2.ПолучитьОбъект().Удалить();
	Товар3.ПолучитьОбъект().Удалить();

	// Удаляем склад
	Склад.ПолучитьОбъект().Удалить();

	// Удаляем временный файл JSON
	Попытка
		УдалитьФайлы(ФайлJson);
	Исключение
		// Игнорируем ошибки удаления файла
	КонецПопытки;

	Возврат РезультатПроверки;

КонецФункции
"
"создай функцию ВыбратьСтрокиТаблицы(Таблица, Склад, Наименование), которая получает на вход параметр типа ТаблицаЗначений
в которой есть колонки ""Склад"", ""Товар"" типа справочник Товары, ""Количество"". Нужно вернуть ТаблицуЗначений, в которую войдут только те строки из входной таблицы, 
у которых значение в колонке ""Склад"" равно параметру Склад, а значение в колонке ""Товар.Наименование"" содержит подстрку параметра ""Наименование"".",,,"Функция ЗадачаРешена(РезультатТаблица) Экспорт

 // Ожидаемые значения для проверки (схематично)
 ОжидаемоеКоличествоСтрок = 2; // Количество отфильтрованных строк
 ОжидаемыйСклад = """"; // Ссылка на склад
 ОжидаемоеНаименованиеТовара1 = """"; // Наименование первого товара
 ОжидаемоеНаименованиеТовара2 = """"; // Наименование второго товара
 ОжидаемоеКоличество1 = 0; // Количество первого товара
 ОжидаемоеКоличество2 = 0; // Количество второго товара

 // Проверяем, что результат является таблицей значений
 Если ТипЗнч(РезультатТаблица) <> Тип(""ТаблицаЗначений"") Тогда
  Возврат Ложь;
 КонецЕсли;

 // Проверяем количество строк в результате
 Если РезультатТаблица.Количество() <> ОжидаемоеКоличествоСтрок Тогда
  Возврат Ложь;
 КонецЕсли;

 // Проверяем наличие необходимых колонок
 Попытка
  Колонки = РезультатТаблица.Колонки;
  Если Колонки.Найти(""Склад"") = Неопределено
   Или Колонки.Найти(""Товар"") = Неопределено
   Или Колонки.Найти(""Количество"") = Неопределено Тогда
   Возврат Ложь;
  КонецЕсли;
 Исключение
  Возврат Ложь;
 КонецПопытки;

 // Проверяем значения в первой строке
 Если РезультатТаблица.Количество() >= 1 Тогда
  Строка1 = РезультатТаблица[0];

  Если Строка1.Склад <> ОжидаемыйСклад Тогда
   Возврат Ложь;
  КонецЕсли;

  Если Строка1.Товар.Наименование <> ОжидаемоеНаименованиеТовара1 Тогда
   Возврат Ложь;
  КонецЕсли;

  Если Строка1.Количество <> ОжидаемоеКоличество1 Тогда
   Возврат Ложь;
  КонецЕсли;
 КонецЕсли;

 // Проверяем значения во второй строке
 Если РезультатТаблица.Количество() >= 2 Тогда
  Строка2 = РезультатТаблица[1];

  Если Строка2.Склад <> ОжидаемыйСклад Тогда
   Возврат Ложь;
  КонецЕсли;

  Если Строка2.Товар.Наименование <> ОжидаемоеНаименованиеТовара2 Тогда
   Возврат Ложь;
  КонецЕсли;

  Если Строка2.Количество <> ОжидаемоеКоличество2 Тогда
   Возврат Ложь;
  КонецЕсли;
 КонецЕсли;

 Возврат Истина;

КонецФункции
","Функция ВыбратьСтрокиТаблицы(Таблица, Склад, Наименование) Экспорт

 // Создаем новую таблицу значений с той же структурой
 РезультатТаблица = Таблица.Скопировать(Новый Структура());
 РезультатТаблица.Очистить();

 // Перебираем строки исходной таблицы
 Для Каждого Строка Из Таблица Цикл

  // Проверяем условие по складу
  Если Строка.Склад <> Склад Тогда
   Продолжить;
  КонецЕсли;

  // Проверяем условие по наименованию товара
  // Наименование является стандартным реквизитом справочника Товары
  Если НЕ СтрНайти(Строка.Товар.Наименование, Наименование) > 0 Тогда
   Продолжить;
  КонецЕсли;

  // Если оба условия выполнены, копируем строку в результат
  НоваяСтрока = РезультатТаблица.Добавить();
  ЗаполнитьЗначенияСвойств(НоваяСтрока, Строка);

 КонецЦикла;

 Возврат РезультатТаблица;

КонецФункции
","Функция ЗапуститьРешение() Экспорт

 // Подготовка тестовых данных

 // Создаем тестовые элементы справочника Склады
 СкладОсновной = Справочники.Склады.СоздатьЭлемент();
 СкладОсновной.Наименование = ""Склад основной (тест task_005)"";
 СкладОсновной.Записать();

 СкладРезервный = Справочники.Склады.СоздатьЭлемент();
 СкладРезервный.Наименование = ""Склад резервный (тест task_005)"";
 СкладРезервный.Записать();

 // Создаем тестовые элементы справочника Товары
 Товар1 = Справочники.Товары.СоздатьЭлемент();
 Товар1.Наименование = ""Компьютер игровой"";
 Товар1.Записать();

 Товар2 = Справочники.Товары.СоздатьЭлемент();
 Товар2.Наименование = ""Компьютер офисный"";
 Товар2.Записать();

 Товар3 = Справочники.Товары.СоздатьЭлемент();
 Товар3.Наименование = ""Монитор LG 27 дюймов"";
 Товар3.Записать();

 // Создаем таблицу значений с тестовыми данными
 Таблица = Новый ТаблицаЗначений;
 Таблица.Колонки.Добавить(""Склад"", Новый ОписаниеТипов(""СправочникСсылка.Склады""));
 Таблица.Колонки.Добавить(""Товар"", Новый ОписаниеТипов(""СправочникСсылка.Товары""));
 Таблица.Колонки.Добавить(""Количество"", Новый ОписаниеТипов(""Число""));

 // Добавляем строки с разными комбинациями
 НоваяСтрока = Таблица.Добавить();
 НоваяСтрока.Склад = СкладОсновной.Ссылка;
 НоваяСтрока.Товар = Товар1.Ссылка;
 НоваяСтрока.Количество = 10;

 НоваяСтрока = Таблица.Добавить();
 НоваяСтрока.Склад = СкладОсновной.Ссылка;
 НоваяСтрока.Товар = Товар2.Ссылка;
 НоваяСтрока.Количество = 5;

 НоваяСтрока = Таблица.Добавить();
 НоваяСтрока.Склад = СкладРезервный.Ссылка;
 НоваяСтрока.Товар = Товар1.Ссылка;
 НоваяСтрока.Количество = 3;

 НоваяСтрока = Таблица.Добавить();
 НоваяСтрока.Склад = СкладОсновной.Ссылка;
 НоваяСтрока.Товар = Товар3.Ссылка;
 НоваяСтрока.Количество = 7;

 // Вызываем функцию решения
 // Ищем товары на основном складе, содержащие в наименовании ""Компьютер""
 РезультатТаблица = ВыбратьСтрокиТаблицы(Таблица, СкладОсновной.Ссылка, ""Компьютер"");

 // Вызываем функцию валидатора для проверки решения задачи
 РезультатПроверки = ЗадачаРешена(РезультатТаблица);

 // Очистка тестовых данных
 Товар1.ПолучитьОбъект().Удалить();
 Товар2.ПолучитьОбъект().Удалить();
 Товар3.ПолучитьОбъект().Удалить();
 СкладОсновной.ПолучитьОбъект().Удалить();
 СкладРезервный.ПолучитьОбъект().Удалить();

 Возврат РезультатПроверки;

КонецФункции
"
"
создай функцию УшедшийТовар(Дата1, Дата2), которая возвращает таблицу значений с товаром, который был на складе (любом) на Дата1, но отсутствует на складе на Дата2. 
Использовать остатки регистра ""ТоварныеЗапасы"".
В таблице должны быть колонки: ""Товар"" (ссылка на справочник Товары), ""Количество"" (количество товара на Дата1).",,,"Функция ЗадачаРешена(РезультатТаблица) Экспорт

 // Ожидаемые значения для проверки (схематично)
 ОжидаемоеКоличествоСтрок = 2; // Количество товаров, которые ушли со склада
 ОжидаемоеНаименованиеТовара1 = """"; // Наименование первого товара
 ОжидаемоеНаименованиеТовара2 = """"; // Наименование второго товара
 ОжидаемоеКоличество1 = 0; // Количество первого товара на Дата1
 ОжидаемоеКоличество2 = 0; // Количество второго товара на Дата1

 // Проверяем, что результат является таблицей значений
 Если ТипЗнч(РезультатТаблица) <> Тип(""ТаблицаЗначений"") Тогда
  Возврат Ложь;
 КонецЕсли;

 // Проверяем количество строк в результате
 Если РезультатТаблица.Количество() <> ОжидаемоеКоличествоСтрок Тогда
  Возврат Ложь;
 КонецЕсли;

 // Проверяем наличие необходимых колонок
 Попытка
  Колонки = РезультатТаблица.Колонки;
  Если Колонки.Найти(""Товар"") = Неопределено
   Или Колонки.Найти(""Количество"") = Неопределено Тогда
   Возврат Ложь;
  КонецЕсли;
 Исключение
  Возврат Ложь;
 КонецПопытки;

 // Проверяем значения в первой строке
 Если РезультатТаблица.Количество() >= 1 Тогда
  Строка1 = РезультатТаблица[0];

  // Проверяем, что товар является справочником
  Если ТипЗнч(Строка1.Товар) <> Тип(""СправочникСсылка.Товары"") Тогда
   Возврат Ложь;
  КонецЕсли;

  Если Строка1.Товар.Наименование <> ОжидаемоеНаименованиеТовара1 Тогда
   Возврат Ложь;
  КонецЕсли;

  Если Строка1.Количество <> ОжидаемоеКоличество1 Тогда
   Возврат Ложь;
  КонецЕсли;
 КонецЕсли;

 // Проверяем значения во второй строке
 Если РезультатТаблица.Количество() >= 2 Тогда
  Строка2 = РезультатТаблица[1];

  // Проверяем, что товар является справочником
  Если ТипЗнч(Строка2.Товар) <> Тип(""СправочникСсылка.Товары"") Тогда
   Возврат Ложь;
  КонецЕсли;

  Если Строка2.Товар.Наименование <> ОжидаемоеНаименованиеТовара2 Тогда
   Возврат Ложь;
  КонецЕсли;

  Если Строка2.Количество <> ОжидаемоеКоличество2 Тогда
   Возврат Ложь;
  КонецЕсли;
 КонецЕсли;

 Возврат Истина;

КонецФункции
","Функция УшедшийТовар(Дата1, Дата2) Экспорт

 // Определяем граничные моменты времени для выборки остатков
 ДатаКон1 = КонецДня(Дата1);
 ДатаКон2 = КонецДня(Дата2);

 // Запрос для получения товаров, которые были на складах на Дата1, но отсутствуют на Дата2
 Запрос = Новый Запрос;
 Запрос.Текст =
 ""ВЫБРАТЬ
 | Остатки1.Товар КАК Товар,
 | СУММА(Остатки1.КоличествоОстаток) КАК Количество
 |ИЗ
 | РегистрНакопления.ТоварныеЗапасы.Остатки(&ДатаКон1, ) КАК Остатки1
 |  ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.ТоварныеЗапасы.Остатки(&ДатаКон2, ) КАК Остатки2
 |  ПО Остатки1.Товар = Остатки2.Товар
 |ГДЕ
 | Остатки1.КоличествоОстаток > 0
 | И (Остатки2.КоличествоОстаток ЕСТЬ NULL
 |  ИЛИ Остатки2.КоличествоОстаток = 0)
 |
 |СГРУППИРОВАТЬ ПО
 | Остатки1.Товар
 |
 |УПОРЯДОЧИТЬ ПО
 | Товар"";

 Запрос.УстановитьПараметр(""ДатаКон1"", ДатаКон1);
 Запрос.УстановитьПараметр(""ДатаКон2"", ДатаКон2);

 Результат = Запрос.Выполнить();

 // Создаем таблицу значений для результата
 РезультатТаблица = Новый ТаблицаЗначений;
 РезультатТаблица.Колонки.Добавить(""Товар"", Новый ОписаниеТипов(""СправочникСсылка.Товары""));
 РезультатТаблица.Колонки.Добавить(""Количество"", Новый ОписаниеТипов(""Число""));

 // Заполняем таблицу результатами запроса
 Выборка = Результат.Выбрать();
 Пока Выборка.Следующий() Цикл
  НоваяСтрока = РезультатТаблица.Добавить();
  НоваяСтрока.Товар = Выборка.Товар;
  НоваяСтрока.Количество = Выборка.Количество;
 КонецЦикла;

 Возврат РезультатТаблица;

КонецФункции
","Функция ЗапуститьРешение() Экспорт

 // Подготовка тестовых данных

 // Создаем тестовые элементы справочника Склады
 СкладОсновной = Справочники.Склады.СоздатьЭлемент();
 СкладОсновной.Наименование = ""Склад основной (тест task_005)"";
 СкладОсновной.Записать();

 // Создаем тестовые элементы справочника Товары
 Товар1 = Справочники.Товары.СоздатьЭлемент();
 Товар1.Наименование = ""Смартфон Samsung (тест task_005)"";
 Товар1.Записать();

 Товар2 = Справочники.Товары.СоздатьЭлемент();
 Товар2.Наименование = ""Планшет Apple (тест task_005)"";
 Товар2.Записать();

 Товар3 = Справочники.Товары.СоздатьЭлемент();
 Товар3.Наименование = ""Ноутбук Lenovo (тест task_005)"";
 Товар3.Записать();

 // Создаем движения в регистре ТоварныеЗапасы для симуляции остатков на Дата1
 // На Дата1 (01.09.2025) будут остатки всех трех товаров
 Дата1 = '20250901';

 // Приходуем товары на Дата1
 МенеджерЗаписи1 = РегистрыНакопления.ТоварныеЗапасы.СоздатьМенеджерЗаписи();
 МенеджерЗаписи1.Период = Дата1;
 МенеджерЗаписи1.ВидДвижения = ВидДвиженияНакопления.Приход;
 МенеджерЗаписи1.Товар = Товар1.Ссылка;
 МенеджерЗаписи1.Склад = СкладОсновной.Ссылка;
 МенеджерЗаписи1.Количество = 100;
 МенеджерЗаписи1.Записать();

 МенеджерЗаписи2 = РегистрыНакопления.ТоварныеЗапасы.СоздатьМенеджерЗаписи();
 МенеджерЗаписи2.Период = Дата1;
 МенеджерЗаписи2.ВидДвижения = ВидДвиженияНакопления.Приход;
 МенеджерЗаписи2.Товар = Товар2.Ссылка;
 МенеджерЗаписи2.Склад = СкладОсновной.Ссылка;
 МенеджерЗаписи2.Количество = 50;
 МенеджерЗаписи2.Записать();

 МенеджерЗаписи3 = РегистрыНакопления.ТоварныеЗапасы.СоздатьМенеджерЗаписи();
 МенеджерЗаписи3.Период = Дата1;
 МенеджерЗаписи3.ВидДвижения = ВидДвиженияНакопления.Приход;
 МенеджерЗаписи3.Товар = Товар3.Ссылка;
 МенеджерЗаписи3.Склад = СкладОсновной.Ссылка;
 МенеджерЗаписи3.Количество = 30;
 МенеджерЗаписи3.Записать();

 // На Дата2 (15.09.2025) расходуем Товар1 и Товар2 полностью
 // Товар3 оставляем на складе
 Дата2 = '20250915';

 МенеджерЗаписи4 = РегистрыНакопления.ТоварныеЗапасы.СоздатьМенеджерЗаписи();
 МенеджерЗаписи4.Период = Дата2;
 МенеджерЗаписи4.ВидДвижения = ВидДвиженияНакопления.Расход;
 МенеджерЗаписи4.Товар = Товар1.Ссылка;
 МенеджерЗаписи4.Склад = СкладОсновной.Ссылка;
 МенеджерЗаписи4.Количество = 100;
 МенеджерЗаписи4.Записать();

 МенеджерЗаписи5 = РегистрыНакопления.ТоварныеЗапасы.СоздатьМенеджерЗаписи();
 МенеджерЗаписи5.Период = Дата2;
 МенеджерЗаписи5.ВидДвижения = ВидДвиженияНакопления.Расход;
 МенеджерЗаписи5.Товар = Товар2.Ссылка;
 МенеджерЗаписи5.Склад = СкладОсновной.Ссылка;
 МенеджерЗаписи5.Количество = 50;
 МенеджерЗаписи5.Записать();

 // Вызываем функцию решения
 // Должны получить Товар1 и Товар2, которые были на Дата1, но отсутствуют на Дата2
 РезультатТаблица = УшедшийТовар(Дата1, Дата2);

 // Вызываем функцию валидатора для проверки решения задачи
 РезультатПроверки = ЗадачаРешена(РезультатТаблица);

 // Очистка тестовых данных
 // Удаляем записи регистра
 НаборЗаписей = РегистрыНакопления.ТоварныеЗапасы.СоздатьНаборЗаписей();
 НаборЗаписей.Отбор.Товар.Установить(Товар1.Ссылка);
 НаборЗаписей.Записать();

 НаборЗаписей = РегистрыНакопления.ТоварныеЗапасы.СоздатьНаборЗаписей();
 НаборЗаписей.Отбор.Товар.Установить(Товар2.Ссылка);
 НаборЗаписей.Записать();

 НаборЗаписей = РегистрыНакопления.ТоварныеЗапасы.СоздатьНаборЗаписей();
 НаборЗаписей.Отбор.Товар.Установить(Товар3.Ссылка);
 НаборЗаписей.Записать();

 // Удаляем справочники
 Товар1.ПолучитьОбъект().Удалить();
 Товар2.ПолучитьОбъект().Удалить();
 Товар3.ПолучитьОбъект().Удалить();
 СкладОсновной.ПолучитьОбъект().Удалить();

 Возврат РезультатПроверки;

КонецФункции
"
"создай функцию ПросроченныеДолги(Дата, МинДолг, СрокДолга), которая возвращает таблицу значений с контрагентами, 
у которых на заданную дату есть долг больше МинДолг, и этот долг образовался более СрокДолга дней назад. Задолженность смотреть в регистре накопления Взаиморасчеты.
В таблице должны быть колонки: Контрагент, Долг, ДатаОбразованияДолга.",,"{
  ""AccumulationRegisters"": [
    {
      ""id"": ""Взаиморасчеты"",
      ""name"": ""Взаиморасчеты"",
      ""RegisterType"": ""Balance"",
      ""Dimensions"": [
        {
          ""id"": ""Контрагент"",
          ""name"": ""Контрагент"",
          ""types"": [
            {
              ""type"": ""Ref"",
              ""id"": ""Справочник.Контрагенты""
            }
          ]
        },
        {
          ""id"": ""Валюта"",
          ""name"": ""Валюта"",
          ""types"": [
            {
              ""type"": ""Ref"",
              ""id"": ""Справочник.Валюты""
            }
          ]
        }
      ],
      ""Resources"": [
        {
          ""id"": ""Сумма"",
          ""name"": ""Сумма"",
          ""types"": [
            {
              ""type"": ""Number"",
              ""NumberQualifiers"": ""10.2""
            }
          ]
        }
      ]
    }
  ]
}","Функция ЗадачаРешена(РезультатТаблица) Экспорт

 // Ожидаемые значения для проверки (схематично)
 ОжидаемоеКоличествоСтрок = 2; // Количество контрагентов с просроченными долгами
 ОжидаемоеНаименованиеКонтрагента1 = """"; // Наименование первого контрагента
 ОжидаемоеНаименованиеКонтрагента2 = """"; // Наименование второго контрагента
 ОжидаемыйДолг1 = 0; // Сумма долга первого контрагента
 ОжидаемыйДолг2 = 0; // Сумма долга второго контрагента
 ОжидаемаяДатаОбразования1 = '00010101'; // Дата образования долга первого контрагента
 ОжидаемаяДатаОбразования2 = '00010101'; // Дата образования долга второго контрагента

 // Проверяем, что результат является таблицей значений
 Если ТипЗнч(РезультатТаблица) <> Тип(""ТаблицаЗначений"") Тогда
  Возврат Ложь;
 КонецЕсли;

 // Проверяем количество строк в результате
 Если РезультатТаблица.Количество() <> ОжидаемоеКоличествоСтрок Тогда
  Возврат Ложь;
 КонецЕсли;

 // Проверяем наличие необходимых колонок
 Попытка
  Колонки = РезультатТаблица.Колонки;
  Если Колонки.Найти(""Контрагент"") = Неопределено
   Или Колонки.Найти(""Долг"") = Неопределено
   Или Колонки.Найти(""ДатаОбразованияДолга"") = Неопределено Тогда
   Возврат Ложь;
  КонецЕсли;
 Исключение
  Возврат Ложь;
 КонецПопытки;

 // Проверяем значения в первой строке
 Если РезультатТаблица.Количество() >= 1 Тогда
  Строка1 = РезультатТаблица[0];

  // Проверяем, что контрагент является справочником
  Если ТипЗнч(Строка1.Контрагент) <> Тип(""СправочникСсылка.Контрагенты"") Тогда
   Возврат Ложь;
  КонецЕсли;

  Если Строка1.Контрагент.Наименование <> ОжидаемоеНаименованиеКонтрагента1 Тогда
   Возврат Ложь;
  КонецЕсли;

  Если Строка1.Долг <> ОжидаемыйДолг1 Тогда
   Возврат Ложь;
  КонецЕсли;

  Если ТипЗнч(Строка1.ДатаОбразованияДолга) <> Тип(""Дата"") Тогда
   Возврат Ложь;
  КонецЕсли;

  Если Строка1.ДатаОбразованияДолга <> ОжидаемаяДатаОбразования1 Тогда
   Возврат Ложь;
  КонецЕсли;
 КонецЕсли;

 // Проверяем значения во второй строке
 Если РезультатТаблица.Количество() >= 2 Тогда
  Строка2 = РезультатТаблица[1];

  // Проверяем, что контрагент является справочником
  Если ТипЗнч(Строка2.Контрагент) <> Тип(""СправочникСсылка.Контрагенты"") Тогда
   Возврат Ложь;
  КонецЕсли;

  Если Строка2.Контрагент.Наименование <> ОжидаемоеНаименованиеКонтрагента2 Тогда
   Возврат Ложь;
  КонецЕсли;

  Если Строка2.Долг <> ОжидаемыйДолг2 Тогда
   Возврат Ложь;
  КонецЕсли;

  Если ТипЗнч(Строка2.ДатаОбразованияДолга) <> Тип(""Дата"") Тогда
   Возврат Ложь;
  КонецЕсли;

  Если Строка2.ДатаОбразованияДолга <> ОжидаемаяДатаОбразования2 Тогда
   Возврат Ложь;
  КонецЕсли;
 КонецЕсли;

 Возврат Истина;

КонецФункции
","Функция ПросроченныеДолги(Дата, МинДолг, СрокДолга) Экспорт

 // Определяем граничную дату для выборки остатков
 ДатаКон = КонецДня(Дата);

 // Определяем дату, ранее которой долг считается просроченным
 ДатаПросрочки = Дата - СрокДолга * 86400; // СрокДолга в днях переводим в секунды

 // Запрос для получения контрагентов с просроченными долгами
 Запрос = Новый Запрос;
 Запрос.Текст =
 ""ВЫБРАТЬ
 | Остатки.Контрагент КАК Контрагент,
 | СУММА(Остатки.СуммаОстаток) КАК Долг
 |ПОМЕСТИТЬ ОстаткиНаДату
 |ИЗ
 | РегистрНакопления.Взаиморасчеты.Остатки(&ДатаКон, ) КАК Остатки
 |ГДЕ
 | Остатки.СуммаОстаток > &МинДолг
 |
 |СГРУППИРОВАТЬ ПО
 | Остатки.Контрагент
 |
 |ИМЕЮЩИЕ
 | СУММА(Остатки.СуммаОстаток) > &МинДолг
 |;
 |
 |////////////////////////////////////////////////////////////////////////////////
 |ВЫБРАТЬ
 | ОстаткиНаДату.Контрагент КАК Контрагент,
 | ОстаткиНаДату.Долг КАК Долг,
 | МИНИМУМ(Движения.Период) КАК ДатаОбразованияДолга
 |ИЗ
 | ОстаткиНаДату КАК ОстаткиНаДату
 |  ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрНакопления.Взаиморасчеты КАК Движения
 |  ПО ОстаткиНаДату.Контрагент = Движения.Контрагент
 |   И Движения.Период <= &ДатаПросрочки
 |   И Движения.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
 |   И Движения.Сумма > 0
 |
 |СГРУППИРОВАТЬ ПО
 | ОстаткиНаДату.Контрагент,
 | ОстаткиНаДату.Долг
 |
 |УПОРЯДОЧИТЬ ПО
 | Долг УБЫВ"";

 Запрос.УстановитьПараметр(""ДатаКон"", ДатаКон);
 Запрос.УстановитьПараметр(""МинДолг"", МинДолг);
 Запрос.УстановитьПараметр(""ДатаПросрочки"", ДатаПросрочки);

 Результат = Запрос.Выполнить();

 // Создаем таблицу значений для результата
 РезультатТаблица = Новый ТаблицаЗначений;
 РезультатТаблица.Колонки.Добавить(""Контрагент"", Новый ОписаниеТипов(""СправочникСсылка.Контрагенты""));
 РезультатТаблица.Колонки.Добавить(""Долг"", Новый ОписаниеТипов(""Число""));
 РезультатТаблица.Колонки.Добавить(""ДатаОбразованияДолга"", Новый ОписаниеТипов(""Дата""));

 // Заполняем таблицу результатами запроса
 Выборка = Результат.Выбрать();
 Пока Выборка.Следующий() Цикл
  НоваяСтрока = РезультатТаблица.Добавить();
  НоваяСтрока.Контрагент = Выборка.Контрагент;
  НоваяСтрока.Долг = Выборка.Долг;
  НоваяСтрока.ДатаОбразованияДолга = Выборка.ДатаОбразованияДолга;
 КонецЦикла;

 Возврат РезультатТаблица;

КонецФункции
","Функция ЗапуститьРешение() Экспорт

 // Подготовка тестовых данных

 // Создаем тестовые элементы справочника Контрагенты
 Контрагент1 = Справочники.Контрагенты.СоздатьЭлемент();
 Контрагент1.Наименование = ""ООО Рога и Копыта (тест task_006)"";
 Контрагент1.Записать();

 Контрагент2 = Справочники.Контрагенты.СоздатьЭлемент();
 Контрагент2.Наименование = ""ИП Иванов (тест task_006)"";
 Контрагент2.Записать();

 Контрагент3 = Справочники.Контрагенты.СоздатьЭлемент();
 Контрагент3.Наименование = ""ООО Быстрая доставка (тест task_006)"";
 Контрагент3.Записать();

 // Создаем тестовую валюту
 Валюта = Справочники.Валюты.НайтиПоНаименованию(""RUB"");
 Если НЕ ЗначениеЗаполнено(Валюта) Тогда
  Валюта = Справочники.Валюты.СоздатьЭлемент();
  Валюта.Наименование = ""RUB"";
  Валюта.Код = ""643"";
  Валюта.Записать();
 КонецЕсли;

 // Текущая дата для теста - 01.10.2025
 ТекущаяДата = '20251001';

 // Контрагент1: долг образовался 100 дней назад (01.06.2025), сумма 150000
 ДатаДолга1 = ТекущаяДата - 100 * 86400;
 МенеджерЗаписи1 = РегистрыНакопления.Взаиморасчеты.СоздатьМенеджерЗаписи();
 МенеджерЗаписи1.Период = ДатаДолга1;
 МенеджерЗаписи1.ВидДвижения = ВидДвиженияНакопления.Приход;
 МенеджерЗаписи1.Контрагент = Контрагент1.Ссылка;
 МенеджерЗаписи1.Валюта = Валюта.Ссылка;
 МенеджерЗаписи1.Сумма = 150000;
 МенеджерЗаписи1.Записать();

 // Контрагент2: долг образовался 50 дней назад (12.08.2025), сумма 80000
 ДатаДолга2 = ТекущаяДата - 50 * 86400;
 МенеджерЗаписи2 = РегистрыНакопления.Взаиморасчеты.СоздатьМенеджерЗаписи();
 МенеджерЗаписи2.Период = ДатаДолга2;
 МенеджерЗаписи2.ВидДвижения = ВидДвиженияНакопления.Приход;
 МенеджерЗаписи2.Контрагент = Контрагент2.Ссылка;
 МенеджерЗаписи2.Валюта = Валюта.Ссылка;
 МенеджерЗаписи2.Сумма = 80000;
 МенеджерЗаписи2.Записать();

 // Контрагент3: долг образовался 10 дней назад (21.09.2025), сумма 200000 (не попадет в выборку по сроку)
 ДатаДолга3 = ТекущаяДата - 10 * 86400;
 МенеджерЗаписи3 = РегистрыНакопления.Взаиморасчеты.СоздатьМенеджерЗаписи();
 МенеджерЗаписи3.Период = ДатаДолга3;
 МенеджерЗаписи3.ВидДвижения = ВидДвиженияНакопления.Приход;
 МенеджерЗаписи3.Контрагент = Контрагент3.Ссылка;
 МенеджерЗаписи3.Валюта = Валюта.Ссылка;
 МенеджерЗаписи3.Сумма = 200000;
 МенеджерЗаписи3.Записать();

 // Вызываем функцию решения
 // Ищем контрагентов с долгом больше 50000 рублей, который образовался более 30 дней назад
 // Должны попасть Контрагент1 (100 дней) и Контрагент2 (50 дней)
 // Контрагент3 не попадет, т.к. долг образовался только 10 дней назад
 РезультатТаблица = ПросроченныеДолги(ТекущаяДата, 50000, 30);

 // Вызываем функцию валидатора для проверки решения задачи
 РезультатПроверки = ЗадачаРешена(РезультатТаблица);

 // Очистка тестовых данных
 // Удаляем записи регистра
 НаборЗаписей = РегистрыНакопления.Взаиморасчеты.СоздатьНаборЗаписей();
 НаборЗаписей.Отбор.Контрагент.Установить(Контрагент1.Ссылка);
 НаборЗаписей.Записать();

 НаборЗаписей = РегистрыНакопления.Взаиморасчеты.СоздатьНаборЗаписей();
 НаборЗаписей.Отбор.Контрагент.Установить(Контрагент2.Ссылка);
 НаборЗаписей.Записать();

 НаборЗаписей = РегистрыНакопления.Взаиморасчеты.СоздатьНаборЗаписей();
 НаборЗаписей.Отбор.Контрагент.Установить(Контрагент3.Ссылка);
 НаборЗаписей.Записать();

 // Удаляем справочники
 Контрагент1.ПолучитьОбъект().Удалить();
 Контрагент2.ПолучитьОбъект().Удалить();
 Контрагент3.ПолучитьОбъект().Удалить();

 Возврат РезультатПроверки;

КонецФункции
"
"создай функцию СоздатьИнтернетПочтовоеСообщение(Письмо, Отправитель)
Параметры:
 - Письмо - СправочникСсылка.ИсходящиеПисьма - элемент справочника, на основании которого
			следует оформить объект системы ИнтернетПочтовоеСообщение для дальнейшей
				отправки с помощью механизмов интернет почты.
- Отправитель - Строка - имя отправителя почтового сообщения

Возвращаемое значение:
    Объект ИнтернетПочтовоеСообщение. Содержит почтовое сообщение, готовое к отправке.",,,"Функция ЗадачаРешена(Сообщение) Экспорт

 // Ожидаемые значения для проверки (схематично)
 ОжидаемыйОтправитель = """"; // Email отправителя
 ОжидаемаяТема = """"; // Тема письма
 ОжидаемоеКоличествоПолучателей = 2; // Количество получателей
 ОжидаемыйПолучатель1 = """"; // Email первого получателя
 ОжидаемыйПолучатель2 = """"; // Email второго получателя
 ОжидаемыйТекст = """"; // Текст сообщения

 // Проверяем, что результат является ИнтернетПочтовымСообщением
 Если ТипЗнч(Сообщение) <> Тип(""ИнтернетПочтовоеСообщение"") Тогда
  Возврат Ложь;
 КонецЕсли;

 // Проверяем отправителя
 Если Сообщение.Отправитель = Неопределено Тогда
  Возврат Ложь;
 КонецЕсли;

 Если ТипЗнч(Сообщение.Отправитель) <> Тип(""ИнтернетПочтовыйАдрес"") Тогда
  Возврат Ложь;
 КонецЕсли;

 Если Сообщение.Отправитель.Адрес <> ОжидаемыйОтправитель Тогда
  Возврат Ложь;
 КонецЕсли;

 // Проверяем тему письма
 Если Сообщение.Тема <> ОжидаемаяТема Тогда
  Возврат Ложь;
 КонецЕсли;

 // Проверяем количество получателей
 Если Сообщение.Получатели.Количество() <> ОжидаемоеКоличествоПолучателей Тогда
  Возврат Ложь;
 КонецЕсли;

 // Проверяем адреса получателей
 Если Сообщение.Получатели.Количество() >= 1 Тогда
  Если ТипЗнч(Сообщение.Получатели[0]) <> Тип(""ИнтернетПочтовыйАдрес"") Тогда
   Возврат Ложь;
  КонецЕсли;

  Если Сообщение.Получатели[0].Адрес <> ОжидаемыйПолучатель1 Тогда
   Возврат Ложь;
  КонецЕсли;
 КонецЕсли;

 Если Сообщение.Получатели.Количество() >= 2 Тогда
  Если ТипЗнч(Сообщение.Получатели[1]) <> Тип(""ИнтернетПочтовыйАдрес"") Тогда
   Возврат Ложь;
  КонецЕсли;

  Если Сообщение.Получатели[1].Адрес <> ОжидаемыйПолучатель2 Тогда
   Возврат Ложь;
  КонецЕсли;
 КонецЕсли;

 // Проверяем наличие текста
 Если Сообщение.Тексты.Количество() < 1 Тогда
  Возврат Ложь;
 КонецЕсли;

 // Проверяем содержимое текста
 ТекстСообщения = Сообщение.Тексты[0].Текст;
 Если ТекстСообщения <> ОжидаемыйТекст Тогда
  Возврат Ложь;
 КонецЕсли;

 // Проверяем, что дата отправления установлена
 Если НЕ ЗначениеЗаполнено(Сообщение.ДатаОтправления) Тогда
  Возврат Ложь;
 КонецЕсли;

 Возврат Истина;

КонецФункции
","Функция СоздатьИнтернетПочтовоеСообщение(Письмо, Отправитель) Экспорт

 // Создаем новое интернет-почтовое сообщение
 Сообщение = Новый ИнтернетПочтовоеСообщение;

 // Устанавливаем отправителя
 Сообщение.Отправитель = Новый ИнтернетПочтовыйАдрес(Отправитель);
 Сообщение.ИмяОтправителя = Отправитель;

 // Устанавливаем тему письма из наименования справочника
 Сообщение.Тема = Письмо.Наименование;

 // Добавляем получателей из табличной части
 Для Каждого СтрокаПолучателя Из Письмо.Получатели Цикл
  Если ЗначениеЗаполнено(СтрокаПолучателя.ЭлектроннаяПочта) Тогда
   Адрес = Новый ИнтернетПочтовыйАдрес(СтрокаПолучателя.ЭлектроннаяПочта);
   Сообщение.Получатели.Добавить(Адрес);
  КонецЕсли;
 КонецЦикла;

 // Если в реквизите Получатель также указан адрес, добавляем его
 Если ЗначениеЗаполнено(Письмо.Получатель) Тогда
  // Проверяем, не добавлен ли уже этот адрес из табличной части
  АдресУжеДобавлен = Ложь;
  Для Каждого Получатель Из Сообщение.Получатели Цикл
   Если Получатель.Адрес = Письмо.Получатель Тогда
    АдресУжеДобавлен = Истина;
    Прервать;
   КонецЕсли;
  КонецЦикла;

  Если НЕ АдресУжеДобавлен Тогда
   АдресДопПолучатель = Новый ИнтернетПочтовыйАдрес(Письмо.Получатель);
   Сообщение.Получатели.Добавить(АдресДопПолучатель);
  КонецЕсли;
 КонецЕсли;

 // Устанавливаем текст сообщения
 Если ЗначениеЗаполнено(Письмо.Текст) Тогда
  ТекстСообщения = Сообщение.Тексты.Добавить(Письмо.Текст);
  ТекстСообщения.ТипТекста = ТипТекстаПочтовогоСообщения.ПростойТекст;
 КонецЕсли;

 // Устанавливаем дату отправления
 Если ЗначениеЗаполнено(Письмо.Дата) Тогда
  Сообщение.ДатаОтправления = Письмо.Дата;
 Иначе
  Сообщение.ДатаОтправления = ТекущаяДатаСеанса();
 КонецЕсли;

 // Обрабатываем вложения из хранилища значения (если есть)
 Если ЗначениеЗаполнено(Письмо.Содержимое) Тогда
  Попытка
   Вложения = Письмо.Содержимое.Получить();
   Если ТипЗнч(Вложения) = Тип(""Массив"") Тогда
    Для Каждого Вложение Из Вложения Цикл
     // Предполагаем, что вложение имеет свойства ИмяФайла и Данные
     Если ТипЗнч(Вложение) = Тип(""Структура"") Тогда
      Если Вложение.Свойство(""ИмяФайла"") И Вложение.Свойство(""Данные"") Тогда
       Вл = Сообщение.Вложения.Добавить(Вложение.Данные, Вложение.ИмяФайла);
      КонецЕсли;
     КонецЕсли;
    КонецЦикла;
   КонецЕсли;
  Исключение
   // Если не удалось обработать вложения, просто пропускаем
  КонецПопытки;
 КонецЕсли;

 Возврат Сообщение;

КонецФункции
","Функция ЗапуститьРешение() Экспорт

 // Подготовка тестовых данных

 // Создаем тестовый элемент справочника ИсходящиеПисьма
 Письмо = Справочники.ИсходящиеПисьма.СоздатьЭлемент();
 Письмо.Наименование = ""Приглашение на встречу (тест task_007)"";
 Письмо.Дата = '20251015120000'; // 15.10.2025 12:00:00
 Письмо.Получатель = ""client@example.com"";
 Письмо.Текст = ""Уважаемый клиент, приглашаем вас на деловую встречу."";

 // Добавляем получателей в табличную часть
 НоваяСтрока = Письмо.Получатели.Добавить();
 НоваяСтрока.ЭлектроннаяПочта = ""manager@company.com"";

 НоваяСтрока = Письмо.Получатели.Добавить();
 НоваяСтрока.ЭлектроннаяПочта = ""director@company.com"";

 // Записываем элемент справочника
 Письмо.Записать();

 // Вызываем функцию решения
 Отправитель = ""noreply@mycompany.com"";
 Сообщение = СоздатьИнтернетПочтовоеСообщение(Письмо.Ссылка, Отправитель);

 // Вызываем функцию валидатора для проверки решения задачи
 РезультатПроверки = ЗадачаРешена(Сообщение);

 // Очистка тестовых данных
 Письмо.ПолучитьОбъект().Удалить();

 Возврат РезультатПроверки;

КонецФункции
"
