task,context,validation,gt_solution,run_context,output,task_id,env
"Создай функцию ЗаполнитьТабличнуюЧастьОстатками(ДокументОбъект), которая заполняет табличную часть документа «Заказ» «Товары» остатками из регистра «ТоварныеЗапасы» для склада и даты, заданных в документе. Отбирать только товары видом товара = Товар. Для каждой позиции остатка нужно добавить строку в табличную часть и перенести туда товар и количество.","{
  ""Documents"": [
    {
      ""id"": ""Заказ"",
      ""properties"": [
        ""Номер"": ""string"",
        ""Дата"": ""date"",
        ""Клиент"": ""Ref.Контрагенты"",
        ""Склад"": ""Ref.Склады"",
        ""Комментарий"": ""string""
      ],
      ""tabularSections"": [
        {
          ""Товары"": [
            ""Номенклатура"": ""Ref.Номенклатура"",
            ""Количество"": ""number"",
            ""Цена"": ""number"",
            ""Сумма"": ""calculated as Количество * Цена""
          ]
        }
      ]
    }
  ]
}","Функция ЗадачаРешена(ДокументОбъект) Экспорт
    // Проверяем ровно две строки и точные количества
    Если ДокументОбъект.Товары.Количество() <> 19 Тогда
        Возврат Ложь;
    КонецЕсли;

   	СуммаКоличеств = 0;
	Для каждого СтрТовар Из ДокументОбъект.Товары Цикл
	    СуммаКоличеств = СуммаКоличеств + СтрТовар.Количество;
	КонецЦикла;

	Возврат СуммаКоличеств = 299;    
	
КонецФункции
","Функция ЗаполнитьТабличнуюЧастьОстатками(ДокументОбъект)
	Запрос = Новый Запрос();
	Запрос.Текст = 
	""ВЫБРАТЬ
	|	Т.Товар КАК Товар,
	|	Т.КоличествоОстаток КАК Количество
	|ИЗ
	|	РегистрНакопления.ТоварныеЗапасы.Остатки(&Дата, Склад = &Склад) КАК Т
	|ГДЕ
	|	Т.Товар.Вид = ЗНАЧЕНИЕ(Перечисление.ВидыТоваров.Товар)"";    
	
	Запрос.УстановитьПараметр(""Дата"",  ДокументОбъект.Дата);   
	Запрос.УстановитьПараметр(""Склад"", ДокументОбъект.Склад);

	Выборка = Запрос.Выполнить().Выбрать();
	Пока Выборка.Следующий() Цикл
		СтрокаТЧ = ДокументОбъект.Товары.Добавить();
		ЗаполнитьЗначенияСвойств(СтрокаТЧ, Выборка);
	КонецЦикла;  
	
КонецФункции
","Функция ЗапуститьРешение() Экспорт
	ДокументОбъект = Документы.Заказ.СоздатьДокумент();	                   
	ДокументОбъект.Дата = '20250920';
	ДокументОбъект.Склад = Справочники.Склады.НайтиПоНаименованию(""Большой"");    
	ЗаполнитьТабличнуюЧастьОстатками(ДокументОбъект);
	
	Возврат ЗадачаРешена(ДокументОбъект);
КонецФункции

","Функция ЗаполнитьТабличнуюЧастьОстатками(ДокументОбъект) Экспорт
	
	// Очищаем табличную часть перед заполнением
	ДокументОбъект.Товары.Очистить();
	
	// Проверяем заполненность обязательных реквизитов
	Если НЕ ЗначениеЗаполнено(ДокументОбъект.Склад) Тогда
		Сообщить(""Не заполнен склад!"");
		Возврат Ложь;
	КонецЕсли;
	
	Если НЕ ЗначениеЗаполнено(ДокументОбъект.Дата) Тогда
		Сообщить(""Не заполнена дата документа!"");
		Возврат Ложь;
	КонецЕсли;
	
	// Создаем запрос для получения остатков
	Запрос = Новый Запрос;
	Запрос.Текст = 
	""ВЫБРАТЬ
	|	ТоварныеЗапасыОстатки.Номенклатура КАК Номенклатура,
	|	ТоварныеЗапасыОстатки.КоличествоОстаток КАК Количество
	|ИЗ
	|	РегистрНакопления.ТоварныеЗапасы.Остатки(
	|		&Дата,
	|		Склад = &Склад
	|		И Номенклатура.ВидНоменклатуры = ЗНАЧЕНИЕ(Перечисление.ВидыНоменклатуры.Товар)) КАК ТоварныеЗапасыОстатки
	|ГДЕ
	|	ТоварныеЗапасыОстатки.КоличествоОстаток > 0
	|
	|УПОРЯДОЧИТЬ ПО
	|	Номенклатура.Наименование"";
	
	Запрос.УстановитьПараметр(""Дата"", ДокументОбъект.Дата);
	Запрос.УстановитьПараметр(""Склад"", ДокументОбъект.Склад);
	
	// Выполняем запрос
	Результат = Запрос.Выполнить();
	
	Если Результат.Пустой() Тогда
		Сообщить(""На складе нет остатков товаров на указанную дату!"");
		Возврат Ложь;
	КонецЕсли;
	
	// Заполняем табличную часть
	Выборка = Результат.Выбрать();
	
	Пока Выборка.Следующий() Цикл
		НоваяСтрока = ДокументОбъект.Товары.Добавить();
		НоваяСтрока.Номенклатура = Выборка.Номенклатура;
		НоваяСтрока.Количество = Выборка.Количество;
		// Цена и Сумма заполнятся автоматически или могут быть заполнены дополнительно
	КонецЦикла;
	
	Сообщить(""Табличная часть заполнена. Добавлено строк: "" + ДокументОбъект.Товары.Количество());
	
	Возврат Истина;
	
КонецФункции",task_001,server
"Создай функцию ЗаполнитьТабличныйДокумент(ТабДокумент, Макет, Дата) которая выводит в табличный документ задолженность по контрагентам из регистра Взаиморасчеты на дату. В макете есть секции Шапка и Строка, в секции строка есть параметры “Контрагент” и “Задолженность”","{
  ""AccumulationRegisters"": [
    {
      ""id"": ""Взаиморасчеты"",
      ""name"": ""Взаиморасчеты"",
      ""RegisterType"": ""Balance"",
      ""Dimensions"": [
        {
          ""id"": ""Контрагент"",
          ""name"": ""Контрагент"",
          ""types"": [
            {
              ""type"": ""Ref"",
              ""id"": ""Справочник.Контрагенты""
            }
          ]
        },
        {
          ""id"": ""Валюта"",
          ""name"": ""Валюта"",
          ""types"": [
            {
              ""type"": ""Ref"",
              ""id"": ""Справочник.Валюты""
            }
          ]
        }
      ],
      ""Resources"": [
        {
          ""id"": ""Сумма"",
          ""name"": ""Сумма"",
          ""types"": [
            {
              ""type"": ""Number"",
              ""NumberQualifiers"": ""10.2""
            }
          ]
        }
      ]
    }
  ]
}","Функция ЗадачаРешена(ТабДокумент) Экспорт

	Если ТабДокумент.ВысотаТаблицы < 13 Тогда 
		Возврат Ложь;
	КонецЕсли;

	// Получаем значения из первых двух строк данных (индексация с 1)
	Значение1 = ТабДокумент.Область(""R1C1"").Текст;  
	Значение2 = ТабДокумент.Область(""R3C1"").Текст;  
	Значение3 = ТабДокумент.Область(""R3C2"").Текст;

	Если Значение1 <> ""Контрагент"" Или Значение2 <> ""Магазин """"Продукты"""""" ИЛИ Значение3 <> ""323390"" Тогда
		Возврат Ложь;
	КонецЕсли;

	Возврат Истина;

КонецФункции


","
Функция ЗаполнитьТабличныйДокумент(ТабДокумент, Макет, Дата) Экспорт

	// Граница периода: берём остатки на конец дня указанной даты
	ДатаКон = КонецДня(Дата);

	// Запрос по виртуальной таблице Остатки регистра ""Взаиморасчеты"".
	// Суммируем по контрагенту (валюту игнорируем — если нужно раздельно по валютам,
	// добавьте поле Валюта в выборку/группировку и параметр в макет).
	Запрос = Новый Запрос;
	Запрос.Текст =
	""ВЫБРАТЬ
	|	Остатки.Контрагент КАК Контрагент,
	|	СУММА(Остатки.СуммаОстаток) КАК Задолженность
	|ИЗ
	|	РегистрНакопления.Взаиморасчеты.Остатки(&ДатаКон, ) КАК Остатки
	|СГРУППИРОВАТЬ ПО
	|	Остатки.Контрагент
	|ИМЕЮЩИЕ
	|	СУММА(Остатки.СуммаОстаток) <> 0
	|УПОРЯДОЧИТЬ ПО
	|	Контрагент"";

	Запрос.УстановитьПараметр(""ДатаКон"", ДатаКон);

	Результат = Запрос.Выполнить();
	Выборка = Результат.Выбрать();

	// Подготовка табличного документа
	ТабДокумент.Очистить();

	Если Макет <> Неопределено Тогда
		ОбластьШапка = Макет.ПолучитьОбласть(""Шапка"");
		Если ОбластьШапка <> Неопределено Тогда
			ТабДокумент.Вывести(ОбластьШапка);
		КонецЕсли;
	КонецЕсли;

	ЕстьДанные = Ложь;

	Пока Выборка.Следующий() Цикл
		ЕстьДанные = Истина;

		ОбластьСтрока = Макет.ПолучитьОбласть(""Строка"");
		Если ОбластьСтрока = Неопределено Тогда
			ВызватьИсключение ""В макете отсутствует секция 'Строка'."";
		КонецЕсли;

		ОбластьСтрока.Параметры.Контрагент    = Выборка.Контрагент;
		ОбластьСтрока.Параметры.Задолженность = Выборка.Задолженность;

		ТабДокумент.Вывести(ОбластьСтрока);
	КонецЦикла;

	Возврат ТабДокумент;

КонецФункции
","Функция ЗапуститьРешение() Экспорт
	Макет = ЭтотОбъект.ПолучитьМакет(""Задача3"");	                   
    ТабДокумент = Новый ТабличныйДокумент();   
	Дата = '20250920';
	ЗаполнитьТабличныйДокумент(ТабДокумент, Макет, Дата);
	
	Возврат ЗадачаРешена(ТабДокумент);
КонецФункции

","Процедура ЗаполнитьТабличныйДокумент(ТабДокумент, Макет, Дата) Экспорт
	
	// Получаем остатки по регистру на указанную дату
	Запрос = Новый Запрос;
	Запрос.Текст = 
	""ВЫБРАТЬ
	|	ВзаиморасчетыОстатки.Контрагент КАК Контрагент,
	|	СУММА(ВзаиморасчетыОстатки.СуммаОстаток) КАК Задолженность
	|ИЗ
	|	РегистрНакопления.Взаиморасчеты.Остатки(&Дата, ) КАК ВзаиморасчетыОстатки
	|
	|СГРУППИРОВАТЬ ПО
	|	ВзаиморасчетыОстатки.Контрагент
	|
	|ИМЕЮЩИЕ
	|	СУММА(ВзаиморасчетыОстатки.СуммаОстаток) <> 0
	|
	|УПОРЯДОЧИТЬ ПО
	|	Контрагент"";
	
	Запрос.УстановитьПараметр(""Дата"", Дата);
	
	Результат = Запрос.Выполнить();
	
	// Очищаем табличный документ
	ТабДокумент.Очистить();
	
	// Выводим шапку
	ОбластьШапка = Макет.ПолучитьОбласть(""Шапка"");
	ТабДокумент.Вывести(ОбластьШапка);
	
	// Получаем область строки
	ОбластьСтрока = Макет.ПолучитьОбласть(""Строка"");
	
	// Выводим данные
	Выборка = Результат.Выбрать();
	
	Пока Выборка.Следующий() Цикл
		
		// Заполняем параметры области
		ОбластьСтрока.Параметры.Контрагент = Выборка.Контрагент;
		ОбластьСтрока.Параметры.Задолженность = Выборка.Задолженность;
		
		// Выводим строку в документ
		ТабДокумент.Вывести(ОбластьСтрока);
		
	КонецЦикла;
	
КонецПроцедуры",task_002,server
"Создай функцию, которая устанавливает во всех строках ТЧ «Товары» значение поля «СкладСтроки» равным реквизиту документа «Склад».","{
  ""Documents"": [
    {
      ""id"": ""Заказ"",
      ""properties"": [
        ""Номер"": ""string"",
        ""Дата"": ""date"",
        ""Клиент"": ""Ref.Контрагенты"",
        ""Склад"": ""Ref.Склады"",
        ""Комментарий"": ""string""
      ],
      ""tabularSections"": [
        {
          ""Товары"": [
            ""Номенклатура"": ""Ref.Номенклатура"",
            ""Количество"": ""number"",
            ""Цена"": ""number"",
            ""Сумма"": ""calculated as Количество * Цена""
          ]
        }
      ]
    }
  ]
}","Функция ЗадачаРешена(ТабДокумент) Экспорт

	Если ТабДокумент.ВысотаТаблицы < 13 Тогда 
		Возврат Ложь;
	КонецЕсли;

	// Получаем значения из первых двух строк данных (индексация с 1)
	Значение1 = ТабДокумент.Область(""R1C1"").Текст;  
	Значение2 = ТабДокумент.Область(""R3C1"").Текст;  
	Значение3 = ТабДокумент.Область(""R3C2"").Текст;

	Если Значение1 <> ""Контрагент"" Или Значение2 <> ""Магазин """"Продукты"""""" ИЛИ Значение3 <> ""323391"" Тогда
		Возврат Ложь;
	КонецЕсли;

	Возврат Истина;

КонецФункции


","
Функция ЗаполнитьТабличныйДокумент(ТабДокумент, Макет, Дата) Экспорт

	// Граница периода: берём остатки на конец дня указанной даты
	ДатаКон = КонецДня(Дата);

	// Запрос по виртуальной таблице Остатки регистра ""Взаиморасчеты"".
	// Суммируем по контрагенту (валюту игнорируем — если нужно раздельно по валютам,
	// добавьте поле Валюта в выборку/группировку и параметр в макет).
	Запрос = Новый Запрос;
	Запрос.Текст =
	""ВЫБРАТЬ
	|	Остатки.Контрагент КАК Контрагент,
	|	СУММА(Остатки.СуммаОстаток) КАК Задолженность
	|ИЗ
	|	РегистрНакопления.Взаиморасчеты.Остатки(&ДатаКон, ) КАК Остатки
	|СГРУППИРОВАТЬ ПО
	|	Остатки.Контрагент
	|ИМЕЮЩИЕ
	|	СУММА(Остатки.СуммаОстаток) <> 0
	|УПОРЯДОЧИТЬ ПО
	|	Контрагент"";

	Запрос.УстановитьПараметр(""ДатаКон"", ДатаКон);

	Результат = Запрос.Выполнить();
	Выборка = Результат.Выбрать();

	// Подготовка табличного документа
	ТабДокумент.Очистить();

	Если Макет <> Неопределено Тогда
		ОбластьШапка = Макет.ПолучитьОбласть(""Шапка"");
		Если ОбластьШапка <> Неопределено Тогда
			ТабДокумент.Вывести(ОбластьШапка);
		КонецЕсли;
	КонецЕсли;

	ЕстьДанные = Ложь;

	Пока Выборка.Следующий() Цикл
		ЕстьДанные = Истина;

		ОбластьСтрока = Макет.ПолучитьОбласть(""Строка"");
		Если ОбластьСтрока = Неопределено Тогда
			ВызватьИсключение ""В макете отсутствует секция 'Строка'."";
		КонецЕсли;

		ОбластьСтрока.Параметры.Контрагент    = Выборка.Контрагент;
		ОбластьСтрока.Параметры.Задолженность = Выборка.Задолженность;

		ТабДокумент.Вывести(ОбластьСтрока);
	КонецЦикла;

	Возврат ТабДокумент;

КонецФункции
","Функция ЗапуститьРешение() Экспорт
	Макет = ЭтотОбъект.ПолучитьМакет(""Задача3"");	                   
    ТабДокумент = Новый ТабличныйДокумент();   
	Дата = '20250920';
	ЗаполнитьТабличныйДокумент(ТабДокумент, Макет, Дата);
	
	Возврат ЗадачаРешена(ТабДокумент);
КонецФункции

","// Функция устанавливает значение реквизита ""Склад"" документа 
// во все строки табличной части ""Товары"" в поле ""СкладСтроки""
//
// Параметры:
//  ДокументОбъект - ДокументОбъект.Заказ - объект документа ""Заказ""
//
Процедура УстановитьСкладВСтрокиТоваров(ДокументОбъект) Экспорт
	
	// Проверяем, что передан объект документа
	Если ДокументОбъект = Неопределено Тогда
		Возврат;
	КонецЕсли;
	
	// Получаем значение склада из реквизита документа
	СкладДокумента = ДокументОбъект.Склад;
	
	// Обходим все строки табличной части ""Товары""
	Для Каждого СтрокаТовары Из ДокументОбъект.Товары Цикл
		
		// Устанавливаем значение склада в поле ""СкладСтроки""
		СтрокаТовары.СкладСтроки = СкладДокумента;
		
	КонецЦикла;
	
КонецПроцедуры

// Альтернативный вариант - функция для использования в обработчиках документа
//
// Пример использования в модуле документа:
// Процедура ПриИзмененииСклада()
//     УстановитьСкладВоВсеСтроки();
// КонецПроцедуры
//
Процедура УстановитьСкладВоВсеСтроки() Экспорт
	
	// Заполняем табличную часть значением из реквизита документа
	Для Каждого СтрокаТовары Из Товары Цикл
		СтрокаТовары.СкладСтроки = Склад;
	КонецЦикла;
	
КонецПроцедуры

// Вариант с использованием метода ЗаполнитьЗначения (более производительный)
//
Процедура УстановитьСкладВоВсеСтрокиБыстро() Экспорт
	
	// Массовое заполнение всех строк одним значением
	Товары.ЗаполнитьЗначения(Склад, ""СкладСтроки"");
	
КонецПроцедуры",task_003,server
Создай функцию УдалитьПоследнююЗапись(Валюта) которая удалять последнюю по времени запись регистра сведений КурсыВалют с измерением Валюта = Валюта,,"Функция ЗадачаРешена(Валюта)      
	
	Запрос = Новый Запрос;   
	Запрос.УстановитьПараметр(""Валюта"", Валюта);
	Запрос.Текст =
	""ВЫБРАТЬ
	|	КурсыВалют.Период КАК Период
	|ИЗ
	|	РегистрСведений.КурсыВалют КАК КурсыВалют
	|ГДЕ
	|	КурсыВалют.Валюта = &Валюта
	|
	|УПОРЯДОЧИТЬ ПО
	|	Период УБЫВ"";  
	
	Выборка = Запрос.Выполнить().Выбрать();
	Если НЕ Выборка.Следующий() Тогда
	
		Возврат Ложь;
	
	КонецЕсли;     
	
	Возврат Выборка.Период = Дата('20221225');

КонецФункции



","Функция УдалитьПоследнююЗапись(Валюта) Экспорт
    
    // 1) Находим самый поздний Период для заданной валюты
    Запрос = Новый Запрос(
    ""ВЫБРАТЬ ПЕРВЫЕ 1
     |    Курсы.Период КАК Период
     |ИЗ
     |    РегистрСведений.КурсыВалют КАК Курсы
     |ГДЕ
     |    Курсы.Валюта = &Валюта
     |УПОРЯДОЧИТЬ ПО
     |    Курсы.Период УБЫВ"");
    Запрос.УстановитьПараметр(""Валюта"", Валюта);

    Рез = Запрос.Выполнить();
    Выборка = Рез.Выбрать();

    Если Не Выборка.Следующий() Тогда
        Возврат Ложь; // записей по валюте нет
    КонецЕсли;

    // 2) Удаляем именно эту запись по ключам (Валюта + Период)
    Менеджер = РегистрыСведений.КурсыВалют.СоздатьМенеджерЗаписи();
    Менеджер.Валюта = Валюта;
    Менеджер.Период = Выборка.Период;
    Менеджер.Прочитать();

    Если Менеджер.Выбран() Тогда
        Менеджер.Удалить();
    КонецЕсли;

КонецФункции

","Функция ЗапуститьРешение() Экспорт
	
	// Снимок всех записей регистра -> ТаблицаЗначений
	НаборВсе = РегистрыСведений.КурсыВалют.СоздатьНаборЗаписей();
	НаборВсе.Прочитать();
	Снимок = НаборВсе.Выгрузить(); // ТаблицаЗначений «как есть»
	ВалютаЮСД = Справочники.Валюты.НайтиПоНаименованию(""USD"");
	УдалитьПоследнююЗапись(ВалютаЮСД);
	
	Решена =  ЗадачаРешена(ВалютаЮСД);

	// Восстановим регистр в исходное состояние
	НаборВосстановление = РегистрыСведений.КурсыВалют.СоздатьНаборЗаписей();
	НаборВосстановление.Записать(); 
	НаборВосстановление.Загрузить(Снимок);
	НаборВосстановление.Записать();  
	
	Возврат Решена;
	
КонецФункции


","Функция УдалитьПоследнюю​Запись(Валюта) Экспорт
	
	// Находим последнюю запись по времени для указанной валюты
	Запрос = Новый Запрос;
	Запрос.Текст = 
	""ВЫБРАТЬ ПЕРВЫЕ 1
	|	КурсыВалют.Период КАК Период,
	|	КурсыВалют.Валюта КАК Валюта
	|ИЗ
	|	РегистрСведений.КурсыВалют КАК КурсыВалют
	|ГДЕ
	|	КурсыВалют.Валюта = &Валюта
	|
	|УПОРЯДОЧИТЬ ПО
	|	КурсыВалют.Период УБЫВ"";
	
	Запрос.УстановитьПараметр(""Валюта"", Валюта);
	
	Результат = Запрос.Выполнить();
	
	Если Результат.Пустой() Тогда
		// Записей не найдено
		Возврат Ложь;
	КонецЕсли;
	
	Выборка = Результат.Выбрать();
	Выборка.Следующий();
	
	// Удаляем найденную запись
	МенеджерЗаписи = РегистрыСведений.КурсыВалют.СоздатьМенеджерЗаписи();
	МенеджерЗаписи.Период = Выборка.Период;
	МенеджерЗаписи.Валюта = Выборка.Валюта;
	МенеджерЗаписи.Удалить();
	
	Возврат Истина;
	
КонецФункции",task_004,server
Создай функцию НеУстановленыЦены(Поставщик) которая возвращает СписокЗначений с элементами справочника Товары у которых Поставщик = Поставщик и нет записи в регистре сведений ЦеныТоваров,"{
  ""InformationRegisters"": [
    {
      ""id"": ""ЦеныТоваров"",
      ""name"": ""Цены товаров"",
      ""InformationRegisterPeriodicity"": ""Day"",
      ""WriteMode"": ""Independent"",
      ""Dimensions"": [
        {
          ""id"": ""Товар"",
          ""name"": ""Товар"",
          ""types"": [
            {
              ""type"": ""Ref"",
              ""id"": ""Справочник.Товары""
            }
          ]
        },
        {
          ""id"": ""ВидЦен"",
          ""name"": ""Вид цен"",
          ""types"": [
            {
              ""type"": ""Ref"",
              ""id"": ""Справочник.ВидыЦен""
            }
          ]
        }
      ],
      ""Resources"": [
        {
          ""id"": ""Цена"",
          ""name"": ""Цена"",
          ""types"": [
            {
              ""type"": ""Number"",
              ""NumberQualifiers"": ""10.2""
            }
          ]
        }
      ]
    }
  ]
}","Функция ЗадачаРешена(СписокТоваров, ОжидаемыеТовары) Экспорт

	// Проверяем тип результата
	Если ТипЗнч(СписокТоваров) <> Тип(""СписокЗначений"") Тогда
		Возврат Ложь;
	КонецЕсли;

	// Проверяем количество элементов
	Если СписокТоваров.Количество() <> ОжидаемыеТовары.Количество() Тогда
		Возврат Ложь;
	КонецЕсли;

	// Проверяем, что все ожидаемые товары присутствуют в списке
	Для Каждого ОжидаемыйТовар Из ОжидаемыеТовары Цикл
		ЭлементСписка = СписокТоваров.НайтиПоЗначению(ОжидаемыйТовар.Значение);
		Если ЭлементСписка = Неопределено Тогда
			Возврат Ложь;
		КонецЕсли;
	КонецЦикла;

	// Проверяем, что в списке нет лишних товаров
	Для Каждого ЭлементСписка Из СписокТоваров Цикл
		Найден = Ложь;
		Для Каждого ОжидаемыйТовар Из ОжидаемыеТовары Цикл
			Если ЭлементСписка.Значение = ОжидаемыйТовар.Значение Тогда
				Найден = Истина;
				Прервать;
			КонецЕсли;
		КонецЦикла;

		Если НЕ Найден Тогда
			Возврат Ложь;
		КонецЕсли;
	КонецЦикла;

	Возврат Истина;

КонецФункции
","Функция НеУстановленыЦены(Поставщик) Экспорт

 // Запрос для получения товаров поставщика, у которых нет записей в регистре ЦеныТоваров
 Запрос = Новый Запрос;
 Запрос.Текст =
 ""ВЫБРАТЬ
 | Товары.Ссылка КАК Товар
 |ИЗ
 | Справочник.Товары КАК Товары
 |  ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ЦеныТоваров КАК ЦеныТоваров
 |  ПО Товары.Ссылка = ЦеныТоваров.Товар
 |ГДЕ
 | Товары.Поставщик = &Поставщик
 | И Товары.ЭтоГруппа = ЛОЖЬ
 | И НЕ Товары.ПометкаУдаления
 | И ЦеныТоваров.Товар ЕСТЬ NULL
 |УПОРЯДОЧИТЬ ПО
 | Товар"";

 Запрос.УстановитьПараметр(""Поставщик"", Поставщик);

 Результат = Запрос.Выполнить();
 Выборка = Результат.Выбрать();

 // Создаём список значений для возврата
 СписокТоваров = Новый СписокЗначений;

 Пока Выборка.Следующий() Цикл
  СписокТоваров.Добавить(Выборка.Товар);
 КонецЦикла;

 Возврат СписокТоваров;

КонецФункции
","Функция ЗапуститьРешение() Экспорт

 	// Подготовка тестовых данных: создаём поставщика
 	Поставщик = Справочники.Контрагенты.НайтиПоНаименованию(""Тестовый поставщик"");

	Если Поставщик.Пустая() Тогда
		Поставщик = Справочники.Контрагенты.СоздатьЭлемент();
		Поставщик.Наименование = ""Тестовый поставщик"";
		Поставщик.Записать();
		Поставщик = Поставщик.Ссылка; 
	КонецЕсли;    
	
	ДругойПоставщик = Справочники.Контрагенты.НайтиПоНаименованию(""Другой поставщик"");

	Если ДругойПоставщик.Пустая() Тогда
		ДругойПоставщик = Справочники.Контрагенты.СоздатьЭлемент();
		ДругойПоставщик.Наименование = ""Другой поставщик"";
		ДругойПоставщик.Записать();
		ДругойПоставщик = Поставщик.Ссылка; 
	КонецЕсли;


 // Создаём вид цен для теста (если нужен)
 ВидЦен = Справочники.ВидыЦен.НайтиПоНаименованию(""Базовая"");

 Если ВидЦен.Пустая() Тогда
  ВидЦен = Справочники.ВидыЦен.СоздатьЭлемент();
  ВидЦен.Наименование = ""Базовая"";
  ВидЦен.Записать(); 
  ВидЦен = ВидЦен.Ссылка; 
 КонецЕсли;

 // Создаём товары для теста
 // Товар 1 - с ценой (не должен попасть в список)
 Товар1 = Справочники.Товары.СоздатьЭлемент();
 Товар1.Наименование = ""Товар с ценой"";
 Товар1.Поставщик = Поставщик;
 Товар1.Записать();

 МенеджерЦены1 = РегистрыСведений.ЦеныТоваров.СоздатьМенеджерЗаписи();
 МенеджерЦены1.Период = ТекущаяДатаСеанса();
 МенеджерЦены1.Товар = Товар1.Ссылка;
 МенеджерЦены1.ВидЦен = ВидЦен;
 МенеджерЦены1.Цена = 100;
 МенеджерЦены1.Записать();

 // Товар 2 - без цены (должен попасть в список)
 Товар2 = Справочники.Товары.СоздатьЭлемент();
 Товар2.Наименование = ""Товар без цены 1"";
 Товар2.Поставщик = Поставщик;
 Товар2.Записать();

 // Товар 3 - без цены (должен попасть в список)
 Товар3 = Справочники.Товары.СоздатьЭлемент();
 Товар3.Наименование = ""Товар без цены 2"";
 Товар3.Поставщик = Поставщик;
 Товар3.Записать();

 Товар4 = Справочники.Товары.СоздатьЭлемент();
 Товар4.Наименование = ""Товар другого поставщика"";
 Товар4.Поставщик = ДругойПоставщик;
 Товар4.Записать();

 // Формируем ожидаемый список товаров без цен
 ОжидаемыеТовары = Новый СписокЗначений;
 ОжидаемыеТовары.Добавить(Товар2.Ссылка);
 ОжидаемыеТовары.Добавить(Товар3.Ссылка);

 // Вызов функции задачи
 СписокТоваров = НеУстановленыЦены(Поставщик);

 // Вызов функции валидатора для проверки решения задачи
 РезультатПроверки = ЗадачаРешена(СписокТоваров, ОжидаемыеТовары);

 // Удаление тестовых данных
 // Удаляем запись регистра цен
 МенеджерУдаления = РегистрыСведений.ЦеныТоваров.СоздатьМенеджерЗаписи();
 МенеджерУдаления.Период = МенеджерЦены1.Период;
 МенеджерУдаления.Товар = Товар1.Ссылка;
 МенеджерУдаления.ВидЦен = ВидЦен;
 МенеджерУдаления.Удалить();

 // Удаляем товары
 Товар1.Удалить();
 Товар2.Удалить();
 Товар3.Удалить();
 Товар4.Удалить();

 // Удаляем контрагентов
 Поставщик.ПолучитьОбъект().Удалить();
 ДругойПоставщик.ПолучитьОбъект().Удалить();

 // Удаляем вид цен
 ВидЦен.ПолучитьОбъект().Удалить();

 Возврат РезультатПроверки;

КонецФункции
","Функция НеУстановленыЦены(Поставщик) Экспорт
	
	СписокЗначений = Новый СписокЗначений;
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
	""ВЫБРАТЬ
	|	Товары.Ссылка КАК Товар
	|ИЗ
	|	Справочник.Товары КАК Товары
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ЦеныТоваров КАК ЦеныТоваров
	|		ПО Товары.Ссылка = ЦеныТоваров.Товар
	|ГДЕ
	|	Товары.Поставщик = &Поставщик
	|	И ЦеныТоваров.Товар ЕСТЬ NULL
	|	И НЕ Товары.ПометкаУдаления
	|
	|УПОРЯДОЧИТЬ ПО
	|	Товар"";
	
	Запрос.УстановитьПараметр(""Поставщик"", Поставщик);
	
	Результат = Запрос.Выполнить();
	Выборка = Результат.Выбрать();
	
	Пока Выборка.Следующий() Цикл
		СписокЗначений.Добавить(Выборка.Товар);
	КонецЦикла;
	
	Возврат СписокЗначений;
	
КонецФункции",task_005,server
"Создай функцию ВыгрузитьОстаткиСклада(Склад, МинимальныйОстаток, ФайлJson), которая получает остаки товаров склада на текущую дату из регистра ТоварныеЗапасы у которых остаток больше или равен значению МинимальныйОстаток. Записать файл в json формате как список с полями ""Товар_Код"", ""Товар_Наименование"", ""Остаток"" (число, округленное до целого). Строки списка должны быть упорядочены по возрастанию поля Товар_Код","{
  ""AccumulationRegisters"": [
    {
      ""id"": ""ТоварныеЗапасы"",
      ""name"": ""Товарные запасы"",
      ""RegisterType"": ""Balance"",
      ""Dimensions"": [
        {
          ""id"": ""Товар"",
          ""name"": ""Товар"",
          ""types"": [
            {
              ""type"": ""Ref"",
              ""id"": ""Справочник.Товары""
            }
          ]
        },
        {
          ""id"": ""Склад"",
          ""name"": ""Склад"",
          ""types"": [
            {
              ""type"": ""Ref"",
              ""id"": ""Справочник.Склады""
            }
          ]
        }
      ],
      ""Resources"": [
        {
          ""id"": ""Количество"",
          ""name"": ""Количество"",
          ""types"": [
            {
              ""type"": ""Number"",
              ""NumberQualifiers"": ""10.2""
            }
          ]
        }
      ]
    }
  ]
}","Функция ЗадачаРешена(ФайлJson) Экспорт
	
	ОжидаемыеДанные = Новый Массив;

	// Только товары с остатком >= 60
	СтрокаТовар = Новый Структура;
	СтрокаТовар.Вставить(""Товар_Код"", ""000000026"");
	СтрокаТовар.Вставить(""Товар_Наименование"", ""Молоко"");
	СтрокаТовар.Вставить(""Остаток"", 100);
	ОжидаемыеДанные.Добавить(СтрокаТовар);    
	
	СтрокаТовар = Новый Структура;
	СтрокаТовар.Вставить(""Товар_Код"", ""000000032"");
	СтрокаТовар.Вставить(""Товар_Наименование"", ""Торт"");
	СтрокаТовар.Вставить(""Остаток"", 100);
	ОжидаемыеДанные.Добавить(СтрокаТовар);

	СтрокаТовар = Новый Структура;
	СтрокаТовар.Вставить(""Товар_Код"", ""000000033"");
	СтрокаТовар.Вставить(""Товар_Наименование"", ""VekoNT02"");
	СтрокаТовар.Вставить(""Остаток"", 195);
	ОжидаемыеДанные.Добавить(СтрокаТовар);

	// Проверяем существование файла
	ФайлОбъект = Новый Файл(ФайлJson);
	Если НЕ ФайлОбъект.Существует() Тогда
		Возврат Ложь;
	КонецЕсли;

	// Читаем JSON из файла
	ЧтениеJSON = Новый ЧтениеJSON;
	ЧтениеJSON.ОткрытьФайл(ФайлJson);
	МассивДанных = ПрочитатьJSON(ЧтениеJSON);
	ЧтениеJSON.Закрыть();

	// Проверяем тип результата
	Если ТипЗнч(МассивДанных) <> Тип(""Массив"") Тогда
		Возврат Ложь;
	КонецЕсли;

	// Проверяем количество элементов
	Если МассивДанных.Количество() <> 4 Тогда
		Возврат Ложь;
	КонецЕсли;

	// Проверяем каждый элемент
	Для Индекс = 0 По 2 Цикл
		ФактическаяСтрока = МассивДанных[Индекс];
		ОжидаемаяСтрока = ОжидаемыеДанные[Индекс];

		// Проверяем наличие обязательных полей
		Если НЕ ФактическаяСтрока.Свойство(""Товар_Код"")
			ИЛИ НЕ ФактическаяСтрока.Свойство(""Товар_Наименование"")
			ИЛИ НЕ ФактическаяСтрока.Свойство(""Остаток"") Тогда
			Возврат Ложь;
		КонецЕсли;

		// Проверяем значения полей
		Если ФактическаяСтрока.Товар_Код <> ОжидаемаяСтрока.Товар_Код
			ИЛИ ФактическаяСтрока.Товар_Наименование <> ОжидаемаяСтрока.Товар_Наименование
			ИЛИ ФактическаяСтрока.Остаток <> ОжидаемаяСтрока.Остаток Тогда
			Возврат Ложь;
		КонецЕсли;

		// Проверяем, что остаток - целое число
		Если ФактическаяСтрока.Остаток <> Окр(ФактическаяСтрока.Остаток, 0) Тогда
			Возврат Ложь;
		КонецЕсли;
	КонецЦикла;

	Возврат Истина;

КонецФункции
","Функция ВыгрузитьОстаткиСклада(Склад, МинимальныйОстаток, ФайлJson) Экспорт

	// Запрос для получения остатков товаров на складе
	Запрос = Новый Запрос;
	Запрос.Текст =
	""ВЫБРАТЬ
	|	Остатки.Товар.Код КАК Товар_Код,
	|	Остатки.Товар.Наименование КАК Товар_Наименование,
	|	Остатки.КоличествоОстаток КАК Остаток
	|ИЗ
	|	РегистрНакопления.ТоварныеЗапасы.Остатки(&ТекущаяДата, Склад = &Склад) КАК Остатки
	|ГДЕ
	|	Остатки.КоличествоОстаток >= &МинимальныйОстаток
	|УПОРЯДОЧИТЬ ПО
	|	Товар_Код"";

	Запрос.УстановитьПараметр(""ТекущаяДата"", ТекущаяДатаСеанса());
	Запрос.УстановитьПараметр(""Склад"", Склад);
	Запрос.УстановитьПараметр(""МинимальныйОстаток"", МинимальныйОстаток);

	Результат = Запрос.Выполнить();
	Выборка = Результат.Выбрать();

	// Формируем массив для JSON
	МассивДанных = Новый Массив;

	Пока Выборка.Следующий() Цикл
		СтрокаДанных = Новый Структура;
		СтрокаДанных.Вставить(""Товар_Код"", Выборка.Товар_Код);
		СтрокаДанных.Вставить(""Товар_Наименование"", Выборка.Товар_Наименование);
		СтрокаДанных.Вставить(""Остаток"", Окр(Выборка.Остаток, 0, РежимОкругления.Окр15как20));

		МассивДанных.Добавить(СтрокаДанных);
	КонецЦикла;

	// Записываем JSON в файл
	ЗаписьJSON = Новый ЗаписьJSON;
	ЗаписьJSON.ОткрытьФайл(ФайлJson);
	ЗаписатьJSON(ЗаписьJSON, МассивДанных);
	ЗаписьJSON.Закрыть();

	Возврат Истина;

КонецФункции
","Функция ЗапуститьРешение() Экспорт

	// Подготовка тестовых данных: создаём склад
	Склад = Справочники.Склады.НайтиПоНаименованию(""Склад отдела продаж"");

	// Формируем ожидаемые данные (минимальный остаток = 10)
	МинимальныйОстаток = 60; 
	
	// Путь к файлу JSON
	ФайлJson = ПолучитьИмяВременногоФайла(""json"");

	// Вызов функции задачи
	ВыгрузитьОстаткиСклада(Склад, МинимальныйОстаток, ФайлJson);

	// Вызов функции валидатора для проверки решения задачи
	РезультатПроверки = ЗадачаРешена(ФайлJson);

	// Удаляем временный файл JSON
	Попытка
		УдалитьФайлы(ФайлJson);
	Исключение
		// Игнорируем ошибки удаления файла
	КонецПопытки;

	Возврат РезультатПроверки;

КонецФункции
","Процедура ВыгрузитьОстаткиСклада(Склад, МинимальныйОстаток, ФайлJson) Экспорт
	
	// Создаем запрос для получения остатков товаров
	Запрос = Новый Запрос;
	Запрос.Текст = 
	""ВЫБРАТЬ
	|	ТоварныеЗапасыОстатки.Товар КАК Товар,
	|	ТоварныеЗапасыОстатки.Товар.Код КАК Товар_Код,
	|	ТоварныеЗапасыОстатки.Товар.Наименование КАК Товар_Наименование,
	|	ТоварныеЗапасыОстатки.КоличествоОстаток КАК Остаток
	|ИЗ
	|	РегистрНакопления.ТоварныеЗапасы.Остатки(, Склад = &Склад) КАК ТоварныеЗапасыОстатки
	|ГДЕ
	|	ТоварныеЗапасыОстатки.КоличествоОстаток >= &МинимальныйОстаток
	|
	|УПОРЯДОЧИТЬ ПО
	|	Товар_Код"";
	
	Запрос.УстановитьПараметр(""Склад"", Склад);
	Запрос.УстановитьПараметр(""МинимальныйОстаток"", МинимальныйОстаток);
	
	// Выполняем запрос
	Результат = Запрос.Выполнить();
	Выборка = Результат.Выбрать();
	
	// Формируем массив для JSON
	МассивДанных = Новый Массив;
	
	Пока Выборка.Следующий() Цикл
		СтрокаДанных = Новый Структура;
		СтрокаДанных.Вставить(""Товар_Код"", Выборка.Товар_Код);
		СтрокаДанных.Вставить(""Товар_Наименование"", Выборка.Товар_Наименование);
		СтрокаДанных.Вставить(""Остаток"", Окр(Выборка.Остаток, 0, РежимОкругления.Окр15как20));
		
		МассивДанных.Добавить(СтрокаДанных);
	КонецЦикла;
	
	// Записываем данные в JSON файл
	ЗаписьJSON = Новый ЗаписьJSON;
	ЗаписьJSON.ОткрытьФайл(ФайлJson, , , Новый ПараметрыЗаписиJSON(ПереносСтрокJSON.Авто, "" ""));
	ЗаписатьJSON(ЗаписьJSON, МассивДанных);
	ЗаписьJSON.Закрыть();
	
КонецПроцедуры",task_006,server
"создай функцию ВыбратьСтрокиТаблицы(Таблица, Склад, Наименование), которая получает на вход параметр типа ТаблицаЗначений
в которой есть колонки ""Склад"", ""Товар"" типа справочник Товары, ""Количество"". Нужно вернуть ТаблицуЗначений, в которую войдут только те строки из входной таблицы, 
у которых значение в колонке ""Склад"" равно параметру Склад, а значение в колонке ""Товар.Наименование"" содержит подстроку параметра ""Наименование"".",,"Функция ЗадачаРешена(РезультатТаблица) Экспорт

	// Ожидаемые значения для проверки (схематично)
	ОжидаемоеКоличествоСтрок = 1; // Количество отфильтрованных строк
	ОжидаемыйСклад = Справочники.Склады.НайтиПоНаименованию(""Большой""); // Ссылка на склад    
	Товар = Справочники.Товары.НайтиПоНаименованию(""Bosch15"");


	// Проверяем, что результат является таблицей значений
	Если ТипЗнч(РезультатТаблица) <> Тип(""ТаблицаЗначений"") Тогда
	 	Возврат Ложь;
	КонецЕсли;

	// Проверяем количество строк в результате
	Если РезультатТаблица.Количество() <> ОжидаемоеКоличествоСтрок Тогда
		Возврат Ложь;
	КонецЕсли;

	// Проверяем наличие необходимых колонок
	Попытка
		Колонки = РезультатТаблица.Колонки;
		Если Колонки.Найти(""Склад"") = Неопределено Или Колонки.Найти(""Товар"") = Неопределено Или Колонки.Найти(""Количество"") = Неопределено Тогда
			Возврат Ложь;
		КонецЕсли;
	Исключение
		Возврат Ложь;
	КонецПопытки;

	// Проверяем значения в первой строке
	Если РезультатТаблица.Количество() >= 1 Тогда
		Строка1 = РезультатТаблица[0];

		Если Строка1.Склад <> ОжидаемыйСклад Тогда
			Возврат Ложь;
		КонецЕсли;

		Если Строка1.Товар <> Товар Тогда
			Возврат Ложь;
		КонецЕсли;

	КонецЕсли;

	Возврат Истина;

КонецФункции
","Функция ВыбратьСтрокиТаблицы(Таблица, Склад, Наименование) Экспорт

	// Создаем новую таблицу значений с той же структурой
	РезультатТаблица = Таблица.Скопировать(Новый Структура());
	РезультатТаблица.Очистить();

	// Перебираем строки исходной таблицы
	Для Каждого Строка Из Таблица Цикл

		// Проверяем условие по складу
		Если Строка.Склад <> Склад Тогда
			Продолжить;
		КонецЕсли;

		// Проверяем условие по наименованию товара
		// Наименование является стандартным реквизитом справочника Товары
		Если НЕ СтрНайти(Строка.Товар.Наименование, Наименование) > 0 Тогда
			Продолжить;
		КонецЕсли;

		// Если оба условия выполнены, копируем строку в результат
		НоваяСтрока = РезультатТаблица.Добавить();
		ЗаполнитьЗначенияСвойств(НоваяСтрока, Строка);

	КонецЦикла;

	Возврат РезультатТаблица;

КонецФункции

","Функция ЗапуститьРешение() Экспорт

	Склад = Справочники.Склады.НайтиПоНаименованию(""Склад отдела продаж"");    
	СкладОтбора = Справочники.Склады.НайтиПоНаименованию(""Большой"");
	
	Товар1 = Справочники.Товары.НайтиПоНаименованию(""Bosch1234"");    
	Товар2 = Справочники.Товары.НайтиПоНаименованию(""Bosch15""); 
	Товар3 = Справочники.Товары.НайтиПоНаименованию(""Босоножки"");

	// Создаем таблицу значений с тестовыми данными
	Таблица = Новый ТаблицаЗначений;
	Таблица.Колонки.Добавить(""Склад"", Новый ОписаниеТипов(""СправочникСсылка.Склады""));
	Таблица.Колонки.Добавить(""Товар"", Новый ОписаниеТипов(""СправочникСсылка.Товары""));
	Таблица.Колонки.Добавить(""Количество"", Новый ОписаниеТипов(""Число""));

	// Добавляем строки с разными комбинациями
	НоваяСтрока = Таблица.Добавить();
	НоваяСтрока.Склад = Склад;
	НоваяСтрока.Товар = Товар1;

	НоваяСтрока = Таблица.Добавить();
	НоваяСтрока.Склад = СкладОтбора;
	НоваяСтрока.Товар = Товар2;

	НоваяСтрока = Таблица.Добавить();
	НоваяСтрока.Склад = СкладОтбора;
	НоваяСтрока.Товар = Товар3;

	НоваяСтрока = Таблица.Добавить();
	НоваяСтрока.Склад = Склад;
	НоваяСтрока.Товар = Товар2;

	// Вызываем функцию решения
	// Ищем товары на основном складе, содержащие в наименовании ""Компьютер""
	РезультатТаблица = ВыбратьСтрокиТаблицы(Таблица, СкладОтбора, ""Bosch"");

	// Вызываем функцию валидатора для проверки решения задачи
	РезультатПроверки = ЗадачаРешена(РезультатТаблица);

	Возврат РезультатПроверки;

КонецФункции
","Функция ВыбратьСтрокиТаблицы(Таблица, Склад, Наименование) Экспорт
	
	// Создаем результирующую таблицу значений с такой же структурой
	РезультатТаблица = Таблица.Скопировать(Новый Массив());
	
	// Проверяем входные параметры
	Если Таблица = Неопределено Или Таблица.Количество() = 0 Тогда
		Возврат РезультатТаблица;
	КонецЕсли;
	
	// Приводим наименование к верхнему регистру для поиска без учета регистра
	НаименованиеВРег = ВРег(СокрЛП(Наименование));
	
	// Перебираем строки исходной таблицы
	Для Каждого Строка Из Таблица Цикл
		
		// Проверяем условие по складу
		СкладСовпадает = Ложь;
		Если Склад = Неопределено Тогда
			СкладСовпадает = Истина;
		ИначеЕсли Строка.Склад = Склад Тогда
			СкладСовпадает = Истина;
		КонецЕсли;
		
		// Проверяем условие по наименованию товара
		НаименованиеСовпадает = Ложь;
		Если ПустаяСтрока(Наименование) Тогда
			НаименованиеСовпадает = Истина;
		ИначеЕсли Строка.Товар <> Неопределено 
			И НЕ Строка.Товар.Пустая() Тогда
			
			// Получаем наименование товара
			ТоварНаименование = ВРег(СокрЛП(Строка.Товар.Наименование));
			
			// Проверяем вхождение подстроки
			Если Найти(ТоварНаименование, НаименованиеВРег) > 0 Тогда
				НаименованиеСовпадает = Истина;
			КонецЕсли;
			
		КонецЕсли;
		
		// Если оба условия выполнены, добавляем строку в результат
		Если СкладСовпадает И НаименованиеСовпадает Тогда
			НоваяСтрока = РезультатТаблица.Добавить();
			ЗаполнитьЗначенияСвойств(НоваяСтрока, Строка);
		КонецЕсли;
		
	КонецЦикла;
	
	Возврат РезультатТаблица;
	
КонецФункции",task_007,server
"
создай функцию УшедшийТовар(Дата1, Дата2), которая возвращает таблицу значений с товаром, который был на складе (любом) на Дата1, но отсутствует на складе на Дата2. 
Использовать остатки регистра ""ТоварныеЗапасы"".
В таблице должны быть колонки: ""Товар"" (ссылка на справочник Товары), ""Количество"" (количество товара на Дата1).",,"
Функция ЗадачаРешена(РезультатТаблица) Экспорт

	// Ожидаемые значения для проверки (схематично)
	ОжидаемоеКоличествоСтрок = 1; // Количество товаров, которые ушли со склада
	Товар = Справочники.Товары.НайтиПоНаименованию(""Veko67NE"");

	// Проверяем, что результат является таблицей значений
	Если ТипЗнч(РезультатТаблица) <> Тип(""ТаблицаЗначений"") Тогда
		Возврат Ложь;
	КонецЕсли;

	// Проверяем количество строк в результате
	Если РезультатТаблица.Количество() <> ОжидаемоеКоличествоСтрок Тогда
		Возврат Ложь;
	КонецЕсли;

	// Проверяем наличие необходимых колонок
	Попытка
		Колонки = РезультатТаблица.Колонки;
		Если Колонки.Найти(""Товар"") = Неопределено ИЛИ Колонки.Найти(""Количество"") = Неопределено Тогда
			Возврат Ложь;
		КонецЕсли;
	Исключение
		Возврат Ложь;
	КонецПопытки;

	// Проверяем значения в первой строке
	Если РезультатТаблица.Количество() >= 1 Тогда
		Строка1 = РезультатТаблица[0];

		// Проверяем, что товар является справочником
		Если Строка1.Товар <> Товар Тогда
			Возврат Ложь;
		КонецЕсли;

		Если Строка1.Количество <> 60 Тогда
			Возврат Ложь;
		КонецЕсли;           
		
	КонецЕсли;

	Возврат Истина;

КонецФункции
","
Функция УшедшийТовар(Дата1, Дата2) Экспорт

	// Определяем граничные моменты времени для выборки остатков
	ДатаКон1 = КонецДня(Дата1);
	ДатаКон2 = КонецДня(Дата2);

	// Запрос для получения товаров, которые были на складах на Дата1, но отсутствуют на Дата2
	Запрос = Новый Запрос;
	Запрос.Текст =
	""ВЫБРАТЬ
	|	Остатки1.Товар КАК Товар,
	|	СУММА(Остатки1.КоличествоОстаток) КАК Количество
	|ИЗ
	|	РегистрНакопления.ТоварныеЗапасы.Остатки(&ДатаКон1, ) КАК Остатки1
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.ТоварныеЗапасы.Остатки(&ДатаКон2, ) КАК Остатки2
	|		ПО Остатки1.Товар = Остатки2.Товар
	|ГДЕ
	|	Остатки1.КоличествоОстаток > 0
	|	И (Остатки2.КоличествоОстаток ЕСТЬ NULL
	|			ИЛИ Остатки2.КоличествоОстаток = 0)
	|
	|СГРУППИРОВАТЬ ПО
	|	Остатки1.Товар
	|
	|УПОРЯДОЧИТЬ ПО
	|	Товар"";

	Запрос.УстановитьПараметр(""ДатаКон1"", ДатаКон1);
	Запрос.УстановитьПараметр(""ДатаКон2"", ДатаКон2);

	Результат = Запрос.Выполнить();

	// Создаем таблицу значений для результата
	РезультатТаблица = Новый ТаблицаЗначений;
	РезультатТаблица.Колонки.Добавить(""Товар"", Новый ОписаниеТипов(""СправочникСсылка.Товары""));
	РезультатТаблица.Колонки.Добавить(""Количество"", Новый ОписаниеТипов(""Число""));

	// Заполняем таблицу результатами запроса
	Выборка = Результат.Выбрать();
	Пока Выборка.Следующий() Цикл
		НоваяСтрока = РезультатТаблица.Добавить();
		НоваяСтрока.Товар = Выборка.Товар;
		НоваяСтрока.Количество = Выборка.Количество;
	КонецЦикла;

	Возврат РезультатТаблица;

КонецФункции

","Функция ЗапуститьРешение() Экспорт

	// Подготовка тестовых данных
	Дата1 = '20230501';  
	Дата2 = '20230503';
	
	// Вызываем функцию решения
	// Должны получить Товар1 и Товар2, которые были на Дата1, но отсутствуют на Дата2
	РезультатТаблица = УшедшийТовар(Дата1, Дата2);

	// Вызываем функцию валидатора для проверки решения задачи
	РезультатПроверки = ЗадачаРешена(РезультатТаблица);

	Возврат РезультатПроверки;

КонецФункции","Функция УшедшийТовар(Дата1, Дата2) Экспорт
	
	// Создаем таблицу значений для результата
	ТаблицаРезультат = Новый ТаблицаЗначений;
	ТаблицаРезультат.Колонки.Добавить(""Товар"", Новый ОписаниеТипов(""СправочникСсылка.Номенклатура""));
	ТаблицаРезультат.Колонки.Добавить(""Количество"", Новый ОписаниеТипов(""Число""));
	
	// Создаем запрос для получения товаров
	Запрос = Новый Запрос;
	Запрос.Текст = 
	""ВЫБРАТЬ
	|	ТоварныеЗапасыОстатки1.Товар КАК Товар,
	|	СУММА(ТоварныеЗапасыОстатки1.КоличествоОстаток) КАК Количество
	|ПОМЕСТИТЬ ОстаткиНаДату1
	|ИЗ
	|	РегистрНакопления.ТоварныеЗапасы.Остатки(&Дата1, ) КАК ТоварныеЗапасыОстатки1
	|ГДЕ
	|	ТоварныеЗапасыОстатки1.КоличествоОстаток > 0
	|
	|СГРУППИРОВАТЬ ПО
	|	ТоварныеЗапасыОстатки1.Товар
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ТоварныеЗапасыОстатки2.Товар КАК Товар,
	|	СУММА(ТоварныеЗапасыОстатки2.КоличествоОстаток) КАК Количество
	|ПОМЕСТИТЬ ОстаткиНаДату2
	|ИЗ
	|	РегистрНакопления.ТоварныеЗапасы.Остатки(&Дата2, ) КАК ТоварныеЗапасыОстатки2
	|ГДЕ
	|	ТоварныеЗапасыОстатки2.КоличествоОстаток > 0
	|
	|СГРУППИРОВАТЬ ПО
	|	ТоварныеЗапасыОстатки2.Товар
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ОстаткиНаДату1.Товар КАК Товар,
	|	ОстаткиНаДату1.Количество КАК Количество
	|ИЗ
	|	ОстаткиНаДату1 КАК ОстаткиНаДату1
	|		ЛЕВОЕ СОЕДИНЕНИЕ ОстаткиНаДату2 КАК ОстаткиНаДату2
	|		ПО ОстаткиНаДату1.Товар = ОстаткиНаДату2.Товар
	|ГДЕ
	|	ОстаткиНаДату2.Товар ЕСТЬ NULL
	|
	|УПОРЯДОЧИТЬ ПО
	|	Товар"";
	
	Запрос.УстановитьПараметр(""Дата1"", Дата1);
	Запрос.УстановитьПараметр(""Дата2"", Дата2);
	
	// Выполняем запрос
	Результат = Запрос.Выполнить();
	
	Если НЕ Результат.Пустой() Тогда
		ТаблицаРезультат = Результат.Выгрузить();
	КонецЕсли;
	
	Возврат ТаблицаРезультат;
	
КонецФункции",task_008,server
"создай функцию ПросроченныеДолги(Дата, МинДолг, СрокДолга), которая возвращает таблицу значений с контрагентами, 
у которых на заданную дату есть долг больше МинДолг, и этот долг, или его часть, образовался более СрокДолга дней назад. Задолженность смотреть в регистре накопления Взаиморасчеты.
В таблице должны быть колонки: Контрагент, ДолгВсего, ДолгПросроченный, ДатаОбразованияДолга.","{
  ""AccumulationRegisters"": [
    {
      ""id"": ""Взаиморасчеты"",
      ""name"": ""Взаиморасчеты"",
      ""RegisterType"": ""Balance"",
      ""Dimensions"": [
        {
          ""id"": ""Контрагент"",
          ""name"": ""Контрагент"",
          ""types"": [
            {
              ""type"": ""Ref"",
              ""id"": ""Справочник.Контрагенты""
            }
          ]
        },
        {
          ""id"": ""Валюта"",
          ""name"": ""Валюта"",
          ""types"": [
            {
              ""type"": ""Ref"",
              ""id"": ""Справочник.Валюты""
            }
          ]
        }
      ],
      ""Resources"": [
        {
          ""id"": ""Сумма"",
          ""name"": ""Сумма"",
          ""types"": [
            {
              ""type"": ""Number"",
              ""NumberQualifiers"": ""10.2""
            }
          ]
        }
      ]
    }
  ]
}","Функция ЗадачаРешена(РезультатТаблица) Экспорт

 // Ожидаемые значения для проверки (схематично)
	ОжидаемоеКоличествоСтрок = 2; // Количество контрагентов с просроченными долгами
	ОжидаемыйКонтрагент2 = Справочники.Контрагенты.НайтиПоНаименованию(""Попов Б.В. ИЧП""); 
	ОжидаемыйКонтрагент1 = Справочники.Контрагенты.НайтиПоНаименованию(""Шлюзовая ООО""); 
	
	// Проверяем, что результат является таблицей значений
	Если ТипЗнч(РезультатТаблица) <> Тип(""ТаблицаЗначений"") Тогда
		Возврат Ложь;
	КонецЕсли;

	// Проверяем количество строк в результате
	Если РезультатТаблица.Количество() <> ОжидаемоеКоличествоСтрок Тогда
		Возврат Ложь;
	КонецЕсли;

	// Проверяем наличие необходимых колонок
	Попытка
		Колонки = РезультатТаблица.Колонки;
		Если Колонки.Найти(""Контрагент"") = Неопределено
			Или Колонки.Найти(""ДолгВсего"") = Неопределено    
			Или Колонки.Найти(""ДолгПросроченный"") = Неопределено
			Или Колонки.Найти(""ДатаОбразованияДолга"") = Неопределено Тогда
			Возврат Ложь;
		КонецЕсли;
	Исключение
		Возврат Ложь;
	КонецПопытки;

	// Проверяем значения в первой строке
	Если РезультатТаблица.Количество() >= 1 Тогда
		Строка = РезультатТаблица[0];

		Если Строка.Контрагент <> ОжидаемыйКонтрагент1 
			ИЛИ Строка.ДолгВсего <> 697169.64      
			ИЛИ Строка.ДолгПросроченный <> 697169.64
			ИЛИ Строка.ДатаОбразованияДолга <> '20230502'
			Тогда
			Возврат Ложь;
		КонецЕсли;

	КонецЕсли;

	// Проверяем значения во второй строке
	Если РезультатТаблица.Количество() >= 2 Тогда
		Строка = РезультатТаблица[1];      
		Если Строка.Контрагент <> ОжидаемыйКонтрагент2 
			ИЛИ Строка.ДолгВсего <> 18300      
			ИЛИ Строка.ДолгПросроченный <> 10300
			ИЛИ Строка.ДатаОбразованияДолга <> '20230603'
			Тогда
			Возврат Ложь;
		КонецЕсли;


	КонецЕсли;

	Возврат Истина;

КонецФункции
","Функция ПросроченныеДолги(Дата, МинДолг, СрокДолга) Экспорт

	// Определяем граничную дату для выборки остатков
	ДатаКон = КонецДня(Дата);

	// Определяем дату, ранее которой долг считается просроченным
	ДатаПросрочки = Дата - СрокДолга * 86400; // СрокДолга в днях переводим в секунды

	// Запрос для получения контрагентов с просроченными долгами
	Запрос = Новый Запрос;
	Запрос.Текст =
	""ВЫБРАТЬ
	|	Остатки.Контрагент КАК Контрагент,
	|	-Остатки.СуммаОстаток КАК Долг
	|ИЗ
	|	РегистрНакопления.Взаиморасчеты.Остатки(&ДатаКон, ) КАК Остатки
	|ГДЕ
	|	-Остатки.СуммаОстаток > &МинДолг
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	Движения.Период КАК Период,
	|	Движения.Контрагент КАК Контрагент,
	|	Движения.Сумма КАК Сумма
	|ИЗ
	|	РегистрНакопления.Взаиморасчеты КАК Движения
	|ГДЕ
	|	Движения.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
	|	И Движения.Период <= &ДатаКон
	|
	|УПОРЯДОЧИТЬ ПО
	|	Период УБЫВ"";

	Запрос.УстановитьПараметр(""ДатаКон"", ДатаКон);
	Запрос.УстановитьПараметр(""МинДолг"", МинДолг);
	Запрос.УстановитьПараметр(""ДатаПросрочки"", ДатаПросрочки);   
	
	// Создаем таблицу значений для результата
	РезультатТаблица = Новый ТаблицаЗначений;
	РезультатТаблица.Колонки.Добавить(""Контрагент"", Новый ОписаниеТипов(""СправочникСсылка.Контрагенты""));
	РезультатТаблица.Колонки.Добавить(""ДолгВсего"", Новый ОписаниеТипов(""Число""));  
	РезультатТаблица.Колонки.Добавить(""ДолгПросроченный"", Новый ОписаниеТипов(""Число""));
	РезультатТаблица.Колонки.Добавить(""ДатаОбразованияДолга"", Новый ОписаниеТипов(""Дата""));

	РезультатВыполненияПакета = Запрос.ВыполнитьПакет();
	ТаблицаДолгов = РезультатВыполненияПакета[0].Выгрузить();   
	ТаблицаДвижений = РезультатВыполненияПакета[1].Выгрузить();
	
	Для каждого СтрокаДолг Из ТаблицаДолгов Цикл
	    Движения = ТаблицаДвижений.НайтиСтроки(Новый Структура(""Контрагент"", СтрокаДолг.Контрагент));
		НакопленныйДолг = 0;  
		ПросроченныйДолг = 0;
		Для каждого СтрокаДвижения Из Движения Цикл
		   	НакопленныйДолг = НакопленныйДолг + СтрокаДвижения.Сумма; 
			
			Если НачалоДня(СтрокаДвижения.Период) <= ДатаПросрочки Тогда
				ПросроченныйДолг = ПросроченныйДолг + СтрокаДвижения.Сумма; 
			КонецЕсли;                         
			
			Если НакопленныйДолг >= СтрокаДолг.Долг Тогда			
				Прервать;				
			КонецЕсли; 
		
		КонецЦикла; 
		
		Если СтрокаДвижения.Период < ДатаПросрочки Тогда
		
			НоваяСтрока = РезультатТаблица.Добавить();
			НоваяСтрока.Контрагент = СтрокаДолг.Контрагент;
			НоваяСтрока.ДолгВсего = СтрокаДолг.Долг;  
			НоваяСтрока.ДолгПросроченный = Мин(ПросроченныйДолг, СтрокаДолг.Долг);
			НоваяСтрока.ДатаОбразованияДолга = НачалоДня(СтрокаДвижения.Период);	
		
		КонецЕсли;
			
	КонецЦикла;

	Возврат РезультатТаблица;

КонецФункции
","Функция ЗапуститьРешение() Экспорт    

	РезультатТаблица = ПросроченныеДолги('20230704', 10000, 30);

	// Вызываем функцию валидатора для проверки решения задачи
	РезультатПроверки = ЗадачаРешена(РезультатТаблица);

	Возврат РезультатПроверки;

КонецФункции
","Функция ПросроченныеДолги(Дата, МинДолг, СрокДолга) Экспорт
	
	// Создаем таблицу значений для результата
	ТаблицаРезультат = Новый ТаблицаЗначений;
	ТаблицаРезультат.Колонки.Добавить(""Контрагент"");
	ТаблицаРезультат.Колонки.Добавить(""ДолгВсего"", Новый ОписаниеТипов(""Число"", Новый КвалификаторыЧисла(15, 2)));
	ТаблицаРезультат.Колонки.Добавить(""ДолгПросроченный"", Новый ОписаниеТипов(""Число"", Новый КвалификаторыЧисла(15, 2)));
	ТаблицаРезультат.Колонки.Добавить(""ДатаОбразованияДолга"", Новый ОписаниеТипов(""Дата""));
	
	// Дата, до которой долг считается просроченным
	ДатаПросрочки = НачалоДня(Дата) - СрокДолга * 86400;
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
	""ВЫБРАТЬ
	|	ВзаиморасчетыОстатки.Контрагент КАК Контрагент,
	|	СУММА(ВзаиморасчетыОстатки.СуммаОстаток) КАК ДолгВсего
	|ПОМЕСТИТЬ ВТОстаткиНаДату
	|ИЗ
	|	РегистрНакопления.Взаиморасчеты.Остатки(&Дата, ) КАК ВзаиморасчетыОстатки
	|
	|СГРУППИРОВАТЬ ПО
	|	ВзаиморасчетыОстатки.Контрагент
	|
	|ИМЕЮЩИЕ
	|	СУММА(ВзаиморасчетыОстатки.СуммаОстаток) >= &МинДолг
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ВзаиморасчетыОстаткиИОбороты.Контрагент КАК Контрагент,
	|	СУММА(ВзаиморасчетыОстаткиИОбороты.СуммаПриход) КАК СуммаПриход,
	|	СУММА(ВзаиморасчетыОстаткиИОбороты.СуммаРасход) КАК СуммаРасход,
	|	МИНИМУМ(ВзаиморасчетыОстаткиИОбороты.Период) КАК ПерваяДатаДвижения
	|ПОМЕСТИТЬ ВТДвиженияПросроченные
	|ИЗ
	|	РегистрНакопления.Взаиморасчеты.ОстаткиИОбороты(, &Дата, , , ) КАК ВзаиморасчетыОстаткиИОбороты
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТОстаткиНаДату КАК ВТОстаткиНаДату
	|		ПО ВзаиморасчетыОстаткиИОбороты.Контрагент = ВТОстаткиНаДату.Контрагент
	|ГДЕ
	|	ВзаиморасчетыОстаткиИОбороты.Период <= &ДатаПросрочки
	|
	|СГРУППИРОВАТЬ ПО
	|	ВзаиморасчетыОстаткиИОбороты.Контрагент
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ВТОстаткиНаДату.Контрагент КАК Контрагент,
	|	ВТОстаткиНаДату.ДолгВсего КАК ДолгВсего,
	|	ЕСТЬNULL(ВТДвиженияПросроченные.СуммаПриход - ВТДвиженияПросроченные.СуммаРасход, 0) КАК ДолгПросроченный,
	|	ЕСТЬNULL(ВТДвиженияПросроченные.ПерваяДатаДвижения, NULL) КАК ДатаОбразованияДолга
	|ИЗ
	|	ВТОстаткиНаДату КАК ВТОстаткиНаДату
	|		ЛЕВОЕ СОЕДИНЕНИЕ ВТДвиженияПросроченные КАК ВТДвиженияПросроченные
	|		ПО ВТОстаткиНаДату.Контрагент = ВТДвиженияПросроченные.Контрагент
	|ГДЕ
	|	ЕСТЬNULL(ВТДвиженияПросроченные.СуммаПриход - ВТДвиженияПросроченные.СуммаРасход, 0) > 0"";
	
	Запрос.УстановитьПараметр(""Дата"", КонецДня(Дата));
	Запрос.УстановитьПараметр(""МинДолг"", МинДолг);
	Запрос.УстановитьПараметр(""ДатаПросрочки"", ДатаПросрочки);
	
	Результат = Запрос.Выполнить();
	
	Если НЕ Результат.Пустой() Тогда
		Выборка = Результат.Выбрать();
		
		Пока Выборка.Следующий() Цикл
			НоваяСтрока = ТаблицаРезультат.Добавить();
			НоваяСтрока.Контрагент = Выборка.Контрагент;
			НоваяСтрока.ДолгВсего = Выборка.ДолгВсего;
			НоваяСтрока.ДолгПросроченный = Выборка.ДолгПросроченный;
			НоваяСтрока.ДатаОбразованияДолга = Выборка.ДатаОбразованияДолга;
		КонецЦикла;
	КонецЕсли;
	
	Возврат ТаблицаРезультат;
	
КонецФункции",task_009,server
"создай функцию СоздатьИнтернетПочтовоеСообщение(Письмо, Отправитель)
Параметры:
 - Письмо - СправочникСсылка.ИсходящиеПисьма - элемент справочника, на основании которого
			следует оформить объект системы ИнтернетПочтовоеСообщение для дальнейшей
				отправки с помощью механизмов интернет почты.
- Отправитель - Строка – email отправителя почтового сообщения

Возвращаемое значение:
    Объект ИнтернетПочтовоеСообщение. Содержит почтовое сообщение, готовое к отправке.","{
  ""Catalogs"": [
    {
      ""id"": ""ИсходящиеПисьма"",
      ""name"": ""Исходящие письма"",
      ""Attributes"": [
        {
          ""id"": ""Дата"",
          ""name"": ""Дата"",
          ""types"": [
            {
              ""type"": ""Date""
            }
          ]
        },
        {
          ""id"": ""Получатель"",
          ""name"": ""Получатель"",
          ""types"": [
            {
              ""type"": ""String"",
              ""StringQualifiers"": ""0""
            }
          ]
        },
        {
          ""id"": ""Содержимое"",
          ""name"": ""Содержимое"",
          ""types"": []
        },
        {
          ""id"": ""Текст"",
          ""name"": ""Текст"",
          ""types"": [
            {
              ""type"": ""String"",
              ""StringQualifiers"": ""0""
            }
          ]
        },
        {
          ""id"": ""Контрагент"",
          ""name"": ""Контрагент"",
          ""types"": [
            {
              ""type"": ""Ref"",
              ""id"": ""Справочник.Контрагенты""
            }
          ]
        }
      ],
      ""TabularSections"": [
        {
          ""id"": ""Получатели"",
          ""name"": ""Получатели"",
          ""Attributes"": [
            {
              ""id"": ""ЭлектроннаяПочта"",
              ""name"": ""Электронная почта"",
              ""types"": [
                {
                  ""type"": ""String"",
                  ""StringQualifiers"": ""1000""
                }
              ]
            }
          ]
        }
      ]
    }
  ]
}","Функция ЗадачаРешена(Сообщение) Экспорт

	// Ожидаемые значения для проверки (схематично)
	ОжидаемыйОтправитель = ""noreply@mycompany.com""; // Email отправителя
	ОжидаемаяТема = ""Предлагаем телевизоры Sony К3456P со скидкой""; // Тема письма
	ОжидаемоеКоличествоПолучателей = 1; // Количество получателей
	ОжидаемыйПолучатель1 = ""givotnovodstvo@mail.ru""; // Email получателя
	ОжидаемыйТекст = ""Предлагаем приобрести телевизоры Sony К3456P со скидкой 30%""; // Текст сообщения

	// Проверяем, что результат является ИнтернетПочтовымСообщением
	Если ТипЗнч(Сообщение) <> Тип(""ИнтернетПочтовоеСообщение"") Тогда
		Возврат Ложь;
	КонецЕсли;

	Если ТипЗнч(Сообщение.Отправитель) <> Тип(""ИнтернетПочтовыйАдрес"") Тогда
		Возврат Ложь;
	КонецЕсли;

	Если Сообщение.Отправитель.Адрес <> ОжидаемыйОтправитель Тогда
		Возврат Ложь;
	КонецЕсли;

	// Проверяем тему письма
	Если Сообщение.Тема <> ОжидаемаяТема Тогда
		Возврат Ложь;
	КонецЕсли;

	// Проверяем количество получателей
	Если Сообщение.Получатели.Количество() <> ОжидаемоеКоличествоПолучателей Тогда
		Возврат Ложь;
	КонецЕсли;

	// Проверяем адреса получателей
	Если Сообщение.Получатели.Количество() >= 1 Тогда
		Если ТипЗнч(Сообщение.Получатели[0]) <> Тип(""ИнтернетПочтовыйАдрес"") Тогда
			Возврат Ложь;
		КонецЕсли;

		Если Сообщение.Получатели[0].Адрес <> ОжидаемыйПолучатель1 Тогда
			Возврат Ложь;
		КонецЕсли;
	КонецЕсли;

	// Проверяем наличие текста
	Если Сообщение.Тексты.Количество() <> 1 Тогда
		Возврат Ложь;
	КонецЕсли;

	// Проверяем содержимое текста
	ТекстСообщения = Сообщение.Тексты[0].Текст;
	Если СтрНайти(ТекстСообщения, ОжидаемыйТекст) = 0 Тогда
		Возврат Ложь;
	КонецЕсли;

	// Проверяем, что дата отправления не установлена
	Если ЗначениеЗаполнено(Сообщение.ДатаОтправления) Тогда
		Возврат Ложь;
	КонецЕсли;

	Возврат Истина;       
 

КонецФункции
","Функция СоздатьИнтернетПочтовоеСообщение(Письмо, Отправитель) Экспорт

	// Создаем новое интернет-почтовое сообщение
	Сообщение = Новый ИнтернетПочтовоеСообщение;

	// Устанавливаем отправителя
	Сообщение.Отправитель = Отправитель;

	// Устанавливаем тему письма из наименования справочника
	Сообщение.Тема = Письмо.Наименование;

	// Добавляем получателей из табличной части
	Для Каждого СтрокаПолучателя Из Письмо.Получатели Цикл
		Если ЗначениеЗаполнено(СтрокаПолучателя.ЭлектроннаяПочта) Тогда
			Сообщение.Получатели.Добавить(СтрокаПолучателя.ЭлектроннаяПочта);
		КонецЕсли;
	КонецЦикла;

	// Если в реквизите Получатель также указан адрес, добавляем его
	Если ЗначениеЗаполнено(Письмо.Получатель) Тогда
		// Проверяем, не добавлен ли уже этот адрес из табличной части
		АдресУжеДобавлен = Ложь;
		Для Каждого Получатель Из Сообщение.Получатели Цикл
			Если Получатель.Адрес = Письмо.Получатель Тогда
				АдресУжеДобавлен = Истина;
				Прервать;
			КонецЕсли;
		КонецЦикла;

		Если НЕ АдресУжеДобавлен Тогда
			Сообщение.Получатели.Добавить(Письмо.Получатель);
		КонецЕсли;
	КонецЕсли;

	// Устанавливаем текст сообщения
	Если ЗначениеЗаполнено(Письмо.Текст) Тогда
		ТекстСообщения = Сообщение.Тексты.Добавить(Письмо.Текст);
		ТекстСообщения.ТипТекста = ТипТекстаПочтовогоСообщения.ПростойТекст;
	КонецЕсли;

	// Обрабатываем вложения из хранилища значения (если есть)
	Если ЗначениеЗаполнено(Письмо.Содержимое) Тогда
		Попытка
			Вложения = Письмо.Содержимое.Получить();
			Если ТипЗнч(Вложения) = Тип(""Массив"") Тогда
				Для Каждого Вложение Из Вложения Цикл
				 // Предполагаем, что вложение имеет свойства ИмяФайла и Данные
					Если ТипЗнч(Вложение) = Тип(""Структура"") Тогда
						Если Вложение.Свойство(""ИмяФайла"") И Вложение.Свойство(""Данные"") Тогда
						   Вл = Сообщение.Вложения.Добавить(Вложение.Данные, Вложение.ИмяФайла);
						КонецЕсли;
					КонецЕсли;
				КонецЦикла;
			КонецЕсли;
		Исключение
		// Если не удалось обработать вложения, просто пропускаем
		КонецПопытки;
	КонецЕсли;

	Возврат Сообщение;

КонецФункции
","Функция ЗапуститьРешение() Экспорт

	// Подготовка тестовых данных
	Письмо = Справочники.ИсходящиеПисьма.НайтиПоНаименованию(""Предлагаем телевизоры Sony К3456P со скидкой"");

	// Вызываем функцию решения
	Отправитель = ""noreply@mycompany.com"";
	Сообщение = СоздатьИнтернетПочтовоеСообщение(Письмо.Ссылка, Отправитель);

	// Вызываем функцию валидатора для проверки решения задачи
	РезультатПроверки = ЗадачаРешена(Сообщение);

	Возврат РезультатПроверки;

КонецФункции","Функция СоздатьИнтернетПочтовоеСообщение(Письмо, Отправитель) Экспорт
	
	// Создаем новое почтовое сообщение
	ПочтовоеСообщение = Новый ИнтернетПочтовоеСообщение;
	
	// Устанавливаем отправителя
	ПочтовоеСообщение.Отправитель = Новый ИнтернетПочтовыйАдрес(Отправитель);
	
	// Устанавливаем тему письма (используем наименование элемента справочника)
	ПочтовоеСообщение.Тема = Строка(Письмо);
	
	// Получаем данные письма из справочника
	Запрос = Новый Запрос;
	Запрос.Текст = 
	""ВЫБРАТЬ
	|	ИсходящиеПисьма.Текст КАК Текст,
	|	ИсходящиеПисьма.Содержимое КАК Содержимое,
	|	ИсходящиеПисьма.Получатель КАК Получатель
	|ИЗ
	|	Справочник.ИсходящиеПисьма КАК ИсходящиеПисьма
	|ГДЕ
	|	ИсходящиеПисьма.Ссылка = &Ссылка"";
	
	Запрос.УстановитьПараметр(""Ссылка"", Письмо);
	
	Результат = Запрос.Выполнить();
	
	Если Результат.Пустой() Тогда
		ВызватьИсключение ""Не удалось получить данные письма из справочника!"";
	КонецЕсли;
	
	Выборка = Результат.Выбрать();
	Выборка.Следующий();
	
	// Устанавливаем текст письма
	Если ЗначениеЗаполнено(Выборка.Текст) Тогда
		ТекстПисьма = Новый ТекстовыйДокумент;
		ТекстПисьма.УстановитьТекст(Выборка.Текст);
		ПочтовоеСообщение.Тексты.Добавить(ТекстПисьма);
	КонецЕсли;
	
	// Добавляем содержимое письма (HTML или вложения)
	Если ЗначениеЗаполнено(Выборка.Содержимое) Тогда
		Попытка
			// Если содержимое - это хранилище значения с HTML или вложениями
			Содержимое = Выборка.Содержимое.Получить();
			
			Если ТипЗнч(Содержимое) = Тип(""Строка"") Тогда
				// HTML текст
				ПочтовоеСообщение.Тексты.Добавить(Содержимое, ТипТекстаПочтовогоСообщения.HTML);
			ИначеЕсли ТипЗнч(Содержимое) = Тип(""ДвоичныеДанные"") Тогда
				// Вложение
				Вложение = ПочтовоеСообщение.Вложения.Добавить(Содержимое, ""attachment.bin"");
			КонецЕсли;
		Исключение
			// Если не удалось обработать содержимое, продолжаем без него
		КонецПопытки;
	КонецЕсли;
	
	// Получаем получателей из табличной части
	Запрос = Новый Запрос;
	Запрос.Текст = 
	""ВЫБРАТЬ
	|	ИсходящиеПисьмаПолучатели.ЭлектроннаяПочта КАК ЭлектроннаяПочта
	|ИЗ
	|	Справочник.ИсходящиеПисьма.Получатели КАК ИсходящиеПисьмаПолучатели
	|ГДЕ
	|	ИсходящиеПисьмаПолучатели.Ссылка = &Ссылка
	|	И ИсходящиеПисьмаПолучатели.ЭлектроннаяПочта <> """""""""";
	
	Запрос.УстановитьПараметр(""Ссылка"", Письмо);
	
	РезультатПолучатели = Запрос.Выполнить();
	
	Если НЕ РезультатПолучатели.Пустой() Тогда
		ВыборкаПолучатели = РезультатПолучатели.Выбрать();
		
		Пока ВыборкаПолучатели.Следующий() Цикл
			Если ЗначениеЗаполнено(ВыборкаПолучатели.ЭлектроннаяПочта) Тогда
				АдресПолучателя = Новый ИнтернетПочтовыйАдрес(ВыборкаПолучатели.ЭлектроннаяПочта);
				ПочтовоеСообщение.Получатели.Добавить(АдресПолучателя);
			КонецЕсли;
		КонецЦикла;
	КонецЕсли;
	
	// Если получатели не заполнены в табличной части, используем реквизит Получатель
	Если ПочтовоеСообщение.Получатели.Количество() = 0 
		И ЗначениеЗаполнено(Выборка.Получатель) Тогда
		АдресПолучателя = Новый ИнтернетПочтовыйАдрес(Выборка.Получатель);
		ПочтовоеСообщение.Получатели.Добавить(АдресПолучателя);
	КонецЕсли;
	
	// Проверяем, что есть хотя бы один получатель
	Если ПочтовоеСообщение.Получатели.Количество() = 0 Тогда
		ВызватьИсключение ""Не указаны получатели письма!"";
	КонецЕсли;
	
	Возврат ПочтовоеСообщение;
	
КонецФункции",task_010,server
