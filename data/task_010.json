{
  "task": "создай функцию СоздатьИнтернетПочтовоеСообщение(Письмо, Отправитель)\nПараметры:\n - Письмо - СправочникСсылка.ИсходящиеПисьма - элемент справочника, на основании которого\n\t\t\tследует оформить объект системы ИнтернетПочтовоеСообщение для дальнейшей\n\t\t\t\tотправки с помощью механизмов интернет почты.\n- Отправитель - Строка – email отправителя почтового сообщения\n\nВозвращаемое значение:\n    Объект ИнтернетПочтовоеСообщение. Содержит почтовое сообщение, готовое к отправке.",
  "context": "{\n  \"Catalogs\": [\n    {\n      \"id\": \"ИсходящиеПисьма\",\n      \"name\": \"Исходящие письма\",\n      \"Attributes\": [\n        {\n          \"id\": \"Дата\",\n          \"name\": \"Дата\",\n          \"types\": [\n            {\n              \"type\": \"Date\"\n            }\n          ]\n        },\n        {\n          \"id\": \"Получатель\",\n          \"name\": \"Получатель\",\n          \"types\": [\n            {\n              \"type\": \"String\",\n              \"StringQualifiers\": \"0\"\n            }\n          ]\n        },\n        {\n          \"id\": \"Содержимое\",\n          \"name\": \"Содержимое\",\n          \"types\": []\n        },\n        {\n          \"id\": \"Текст\",\n          \"name\": \"Текст\",\n          \"types\": [\n            {\n              \"type\": \"String\",\n              \"StringQualifiers\": \"0\"\n            }\n          ]\n        },\n        {\n          \"id\": \"Контрагент\",\n          \"name\": \"Контрагент\",\n          \"types\": [\n            {\n              \"type\": \"Ref\",\n              \"id\": \"Справочник.Контрагенты\"\n            }\n          ]\n        }\n      ],\n      \"TabularSections\": [\n        {\n          \"id\": \"Получатели\",\n          \"name\": \"Получатели\",\n          \"Attributes\": [\n            {\n              \"id\": \"ЭлектроннаяПочта\",\n              \"name\": \"Электронная почта\",\n              \"types\": [\n                {\n                  \"type\": \"String\",\n                  \"StringQualifiers\": \"1000\"\n                }\n              ]\n            }\n          ]\n        }\n      ]\n    }\n  ]\n}",
  "validation": "Функция ЗадачаРешена(Сообщение) Экспорт\n\n\t// Ожидаемые значения для проверки (схематично)\n\tОжидаемыйОтправитель = \"noreply@mycompany.com\"; // Email отправителя\n\tОжидаемаяТема = \"Предлагаем телевизоры Sony К3456P со скидкой\"; // Тема письма\n\tОжидаемоеКоличествоПолучателей = 1; // Количество получателей\n\tОжидаемыйПолучатель1 = \"givotnovodstvo@mail.ru\"; // Email получателя\n\tОжидаемыйТекст = \"Предлагаем приобрести телевизоры Sony К3456P со скидкой 30%\"; // Текст сообщения\n\n\t// Проверяем, что результат является ИнтернетПочтовымСообщением\n\tЕсли ТипЗнч(Сообщение) <> Тип(\"ИнтернетПочтовоеСообщение\") Тогда\n\t\tВозврат Ложь;\n\tКонецЕсли;\n\n\tЕсли ТипЗнч(Сообщение.Отправитель) <> Тип(\"ИнтернетПочтовыйАдрес\") Тогда\n\t\tВозврат Ложь;\n\tКонецЕсли;\n\n\tЕсли Сообщение.Отправитель.Адрес <> ОжидаемыйОтправитель Тогда\n\t\tВозврат Ложь;\n\tКонецЕсли;\n\n\t// Проверяем тему письма\n\tЕсли Сообщение.Тема <> ОжидаемаяТема Тогда\n\t\tВозврат Ложь;\n\tКонецЕсли;\n\n\t// Проверяем количество получателей\n\tЕсли Сообщение.Получатели.Количество() <> ОжидаемоеКоличествоПолучателей Тогда\n\t\tВозврат Ложь;\n\tКонецЕсли;\n\n\t// Проверяем адреса получателей\n\tЕсли Сообщение.Получатели.Количество() >= 1 Тогда\n\t\tЕсли ТипЗнч(Сообщение.Получатели[0]) <> Тип(\"ИнтернетПочтовыйАдрес\") Тогда\n\t\t\tВозврат Ложь;\n\t\tКонецЕсли;\n\n\t\tЕсли Сообщение.Получатели[0].Адрес <> ОжидаемыйПолучатель1 Тогда\n\t\t\tВозврат Ложь;\n\t\tКонецЕсли;\n\tКонецЕсли;\n\n\t// Проверяем наличие текста\n\tЕсли Сообщение.Тексты.Количество() <> 1 Тогда\n\t\tВозврат Ложь;\n\tКонецЕсли;\n\n\t// Проверяем содержимое текста\n\tТекстСообщения = Сообщение.Тексты[0].Текст;\n\tЕсли СтрНайти(ТекстСообщения, ОжидаемыйТекст) = 0 Тогда\n\t\tВозврат Ложь;\n\tКонецЕсли;\n\n\t// Проверяем, что дата отправления не установлена\n\tЕсли ЗначениеЗаполнено(Сообщение.ДатаОтправления) Тогда\n\t\tВозврат Ложь;\n\tКонецЕсли;\n\n\tВозврат Истина;       \n \n\nКонецФункции\n",
  "gt_solution": "Функция СоздатьИнтернетПочтовоеСообщение(Письмо, Отправитель) Экспорт\n\n\t// Создаем новое интернет-почтовое сообщение\n\tСообщение = Новый ИнтернетПочтовоеСообщение;\n\n\t// Устанавливаем отправителя\n\tСообщение.Отправитель = Отправитель;\n\n\t// Устанавливаем тему письма из наименования справочника\n\tСообщение.Тема = Письмо.Наименование;\n\n\t// Добавляем получателей из табличной части\n\tДля Каждого СтрокаПолучателя Из Письмо.Получатели Цикл\n\t\tЕсли ЗначениеЗаполнено(СтрокаПолучателя.ЭлектроннаяПочта) Тогда\n\t\t\tСообщение.Получатели.Добавить(СтрокаПолучателя.ЭлектроннаяПочта);\n\t\tКонецЕсли;\n\tКонецЦикла;\n\n\t// Если в реквизите Получатель также указан адрес, добавляем его\n\tЕсли ЗначениеЗаполнено(Письмо.Получатель) Тогда\n\t\t// Проверяем, не добавлен ли уже этот адрес из табличной части\n\t\tАдресУжеДобавлен = Ложь;\n\t\tДля Каждого Получатель Из Сообщение.Получатели Цикл\n\t\t\tЕсли Получатель.Адрес = Письмо.Получатель Тогда\n\t\t\t\tАдресУжеДобавлен = Истина;\n\t\t\t\tПрервать;\n\t\t\tКонецЕсли;\n\t\tКонецЦикла;\n\n\t\tЕсли НЕ АдресУжеДобавлен Тогда\n\t\t\tСообщение.Получатели.Добавить(Письмо.Получатель);\n\t\tКонецЕсли;\n\tКонецЕсли;\n\n\t// Устанавливаем текст сообщения\n\tЕсли ЗначениеЗаполнено(Письмо.Текст) Тогда\n\t\tТекстСообщения = Сообщение.Тексты.Добавить(Письмо.Текст);\n\t\tТекстСообщения.ТипТекста = ТипТекстаПочтовогоСообщения.ПростойТекст;\n\tКонецЕсли;\n\n\t// Обрабатываем вложения из хранилища значения (если есть)\n\tЕсли ЗначениеЗаполнено(Письмо.Содержимое) Тогда\n\t\tПопытка\n\t\t\tВложения = Письмо.Содержимое.Получить();\n\t\t\tЕсли ТипЗнч(Вложения) = Тип(\"Массив\") Тогда\n\t\t\t\tДля Каждого Вложение Из Вложения Цикл\n\t\t\t\t // Предполагаем, что вложение имеет свойства ИмяФайла и Данные\n\t\t\t\t\tЕсли ТипЗнч(Вложение) = Тип(\"Структура\") Тогда\n\t\t\t\t\t\tЕсли Вложение.Свойство(\"ИмяФайла\") И Вложение.Свойство(\"Данные\") Тогда\n\t\t\t\t\t\t   Вл = Сообщение.Вложения.Добавить(Вложение.Данные, Вложение.ИмяФайла);\n\t\t\t\t\t\tКонецЕсли;\n\t\t\t\t\tКонецЕсли;\n\t\t\t\tКонецЦикла;\n\t\t\tКонецЕсли;\n\t\tИсключение\n\t\t// Если не удалось обработать вложения, просто пропускаем\n\t\tКонецПопытки;\n\tКонецЕсли;\n\n\tВозврат Сообщение;\n\nКонецФункции\n",
  "run_context": "Функция ЗапуститьРешение() Экспорт\n\n\t// Подготовка тестовых данных\n\tПисьмо = Справочники.ИсходящиеПисьма.НайтиПоНаименованию(\"Предлагаем телевизоры Sony К3456P со скидкой\");\n\n\t// Вызываем функцию решения\n\tОтправитель = \"noreply@mycompany.com\";\n\tСообщение = СоздатьИнтернетПочтовоеСообщение(Письмо.Ссылка, Отправитель);\n\n\t// Вызываем функцию валидатора для проверки решения задачи\n\tРезультатПроверки = ЗадачаРешена(Сообщение);\n\n\tВозврат РезультатПроверки;\n\nКонецФункции"
}