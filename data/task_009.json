{
  "task": "создай функцию ПросроченныеДолги(Дата, МинДолг, СрокДолга), которая возвращает таблицу значений с контрагентами, \nу которых на заданную дату есть долг больше МинДолг, и этот долг, или его часть, образовался более СрокДолга дней назад. Задолженность смотреть в регистре накопления Взаиморасчеты.\nВ таблице должны быть колонки: Контрагент, ДолгВсего, ДолгПросроченный, ДатаОбразованияДолга.",
  "context": "{\n  \"AccumulationRegisters\": [\n    {\n      \"id\": \"Взаиморасчеты\",\n      \"name\": \"Взаиморасчеты\",\n      \"RegisterType\": \"Balance\",\n      \"Dimensions\": [\n        {\n          \"id\": \"Контрагент\",\n          \"name\": \"Контрагент\",\n          \"types\": [\n            {\n              \"type\": \"Ref\",\n              \"id\": \"Справочник.Контрагенты\"\n            }\n          ]\n        },\n        {\n          \"id\": \"Валюта\",\n          \"name\": \"Валюта\",\n          \"types\": [\n            {\n              \"type\": \"Ref\",\n              \"id\": \"Справочник.Валюты\"\n            }\n          ]\n        }\n      ],\n      \"Resources\": [\n        {\n          \"id\": \"Сумма\",\n          \"name\": \"Сумма\",\n          \"types\": [\n            {\n              \"type\": \"Number\",\n              \"NumberQualifiers\": \"10.2\"\n            }\n          ]\n        }\n      ]\n    }\n  ]\n}",
  "validation": "Функция ЗадачаРешена(РезультатТаблица) Экспорт\n\n // Ожидаемые значения для проверки (схематично)\n\tОжидаемоеКоличествоСтрок = 2; // Количество контрагентов с просроченными долгами\n\tОжидаемыйКонтрагент2 = Справочники.Контрагенты.НайтиПоНаименованию(\"Попов Б.В. ИЧП\"); \n\tОжидаемыйКонтрагент1 = Справочники.Контрагенты.НайтиПоНаименованию(\"Шлюзовая ООО\"); \n\t\n\t// Проверяем, что результат является таблицей значений\n\tЕсли ТипЗнч(РезультатТаблица) <> Тип(\"ТаблицаЗначений\") Тогда\n\t\tВозврат Ложь;\n\tКонецЕсли;\n\n\t// Проверяем количество строк в результате\n\tЕсли РезультатТаблица.Количество() <> ОжидаемоеКоличествоСтрок Тогда\n\t\tВозврат Ложь;\n\tКонецЕсли;\n\n\t// Проверяем наличие необходимых колонок\n\tПопытка\n\t\tКолонки = РезультатТаблица.Колонки;\n\t\tЕсли Колонки.Найти(\"Контрагент\") = Неопределено\n\t\t\tИли Колонки.Найти(\"ДолгВсего\") = Неопределено    \n\t\t\tИли Колонки.Найти(\"ДолгПросроченный\") = Неопределено\n\t\t\tИли Колонки.Найти(\"ДатаОбразованияДолга\") = Неопределено Тогда\n\t\t\tВозврат Ложь;\n\t\tКонецЕсли;\n\tИсключение\n\t\tВозврат Ложь;\n\tКонецПопытки;\n\n\t// Проверяем значения в первой строке\n\tЕсли РезультатТаблица.Количество() >= 1 Тогда\n\t\tСтрока = РезультатТаблица[0];\n\n\t\tЕсли Строка.Контрагент <> ОжидаемыйКонтрагент1 \n\t\t\tИЛИ Строка.ДолгВсего <> 697169.64      \n\t\t\tИЛИ Строка.ДолгПросроченный <> 697169.64\n\t\t\tИЛИ Строка.ДатаОбразованияДолга <> '20230502'\n\t\t\tТогда\n\t\t\tВозврат Ложь;\n\t\tКонецЕсли;\n\n\tКонецЕсли;\n\n\t// Проверяем значения во второй строке\n\tЕсли РезультатТаблица.Количество() >= 2 Тогда\n\t\tСтрока = РезультатТаблица[1];      \n\t\tЕсли Строка.Контрагент <> ОжидаемыйКонтрагент2 \n\t\t\tИЛИ Строка.ДолгВсего <> 18300      \n\t\t\tИЛИ Строка.ДолгПросроченный <> 10300\n\t\t\tИЛИ Строка.ДатаОбразованияДолга <> '20230603'\n\t\t\tТогда\n\t\t\tВозврат Ложь;\n\t\tКонецЕсли;\n\n\n\tКонецЕсли;\n\n\tВозврат Истина;\n\nКонецФункции\n",
  "gt_solution": "Функция ПросроченныеДолги(Дата, МинДолг, СрокДолга) Экспорт\n\n\t// Определяем граничную дату для выборки остатков\n\tДатаКон = КонецДня(Дата);\n\n\t// Определяем дату, ранее которой долг считается просроченным\n\tДатаПросрочки = Дата - СрокДолга * 86400; // СрокДолга в днях переводим в секунды\n\n\t// Запрос для получения контрагентов с просроченными долгами\n\tЗапрос = Новый Запрос;\n\tЗапрос.Текст =\n\t\"ВЫБРАТЬ\n\t|\tОстатки.Контрагент КАК Контрагент,\n\t|\t-Остатки.СуммаОстаток КАК Долг\n\t|ИЗ\n\t|\tРегистрНакопления.Взаиморасчеты.Остатки(&ДатаКон, ) КАК Остатки\n\t|ГДЕ\n\t|\t-Остатки.СуммаОстаток > &МинДолг\n\t|;\n\t|\n\t|////////////////////////////////////////////////////////////////////////////////\n\t|ВЫБРАТЬ\n\t|\tДвижения.Период КАК Период,\n\t|\tДвижения.Контрагент КАК Контрагент,\n\t|\tДвижения.Сумма КАК Сумма\n\t|ИЗ\n\t|\tРегистрНакопления.Взаиморасчеты КАК Движения\n\t|ГДЕ\n\t|\tДвижения.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)\n\t|\tИ Движения.Период <= &ДатаКон\n\t|\n\t|УПОРЯДОЧИТЬ ПО\n\t|\tПериод УБЫВ\";\n\n\tЗапрос.УстановитьПараметр(\"ДатаКон\", ДатаКон);\n\tЗапрос.УстановитьПараметр(\"МинДолг\", МинДолг);\n\tЗапрос.УстановитьПараметр(\"ДатаПросрочки\", ДатаПросрочки);   \n\t\n\t// Создаем таблицу значений для результата\n\tРезультатТаблица = Новый ТаблицаЗначений;\n\tРезультатТаблица.Колонки.Добавить(\"Контрагент\", Новый ОписаниеТипов(\"СправочникСсылка.Контрагенты\"));\n\tРезультатТаблица.Колонки.Добавить(\"ДолгВсего\", Новый ОписаниеТипов(\"Число\"));  \n\tРезультатТаблица.Колонки.Добавить(\"ДолгПросроченный\", Новый ОписаниеТипов(\"Число\"));\n\tРезультатТаблица.Колонки.Добавить(\"ДатаОбразованияДолга\", Новый ОписаниеТипов(\"Дата\"));\n\n\tРезультатВыполненияПакета = Запрос.ВыполнитьПакет();\n\tТаблицаДолгов = РезультатВыполненияПакета[0].Выгрузить();   \n\tТаблицаДвижений = РезультатВыполненияПакета[1].Выгрузить();\n\t\n\tДля каждого СтрокаДолг Из ТаблицаДолгов Цикл\n\t    Движения = ТаблицаДвижений.НайтиСтроки(Новый Структура(\"Контрагент\", СтрокаДолг.Контрагент));\n\t\tНакопленныйДолг = 0;  \n\t\tПросроченныйДолг = 0;\n\t\tДля каждого СтрокаДвижения Из Движения Цикл\n\t\t   \tНакопленныйДолг = НакопленныйДолг + СтрокаДвижения.Сумма; \n\t\t\t\n\t\t\tЕсли НачалоДня(СтрокаДвижения.Период) <= ДатаПросрочки Тогда\n\t\t\t\tПросроченныйДолг = ПросроченныйДолг + СтрокаДвижения.Сумма; \n\t\t\tКонецЕсли;                         \n\t\t\t\n\t\t\tЕсли НакопленныйДолг >= СтрокаДолг.Долг Тогда\t\t\t\n\t\t\t\tПрервать;\t\t\t\t\n\t\t\tКонецЕсли; \n\t\t\n\t\tКонецЦикла; \n\t\t\n\t\tЕсли СтрокаДвижения.Период < ДатаПросрочки Тогда\n\t\t\n\t\t\tНоваяСтрока = РезультатТаблица.Добавить();\n\t\t\tНоваяСтрока.Контрагент = СтрокаДолг.Контрагент;\n\t\t\tНоваяСтрока.ДолгВсего = СтрокаДолг.Долг;  \n\t\t\tНоваяСтрока.ДолгПросроченный = Мин(ПросроченныйДолг, СтрокаДолг.Долг);\n\t\t\tНоваяСтрока.ДатаОбразованияДолга = НачалоДня(СтрокаДвижения.Период);\t\n\t\t\n\t\tКонецЕсли;\n\t\t\t\n\tКонецЦикла;\n\n\tВозврат РезультатТаблица;\n\nКонецФункции\n",
  "run_context": "Функция ЗапуститьРешение() Экспорт    \n\n\tРезультатТаблица = ПросроченныеДолги('20230704', 10000, 30);\n\n\t// Вызываем функцию валидатора для проверки решения задачи\n\tРезультатПроверки = ЗадачаРешена(РезультатТаблица);\n\n\tВозврат РезультатПроверки;\n\nКонецФункции\n"
}